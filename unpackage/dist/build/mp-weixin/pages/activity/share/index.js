(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/share/index"],{"619d":function(e,t,a){"use strict";a.r(t);var o=a("e640"),s=a.n(o);for(var n in o)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(n);t["default"]=s.a},"69b7":function(e,t,a){"use strict";a.r(t);var o=a("e5af"),s=a("619d");for(var n in s)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(n);a("a2b5");var i=a("f0c5"),r=Object(i["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=r.exports},"7b60":function(e,t,a){},a2b5:function(e,t,a){"use strict";var o=a("7b60"),s=a.n(o);s.a},bf81f:function(e,t,a){"use strict";(function(e,t){var o=a("4ea4");a("4319");o(a("66fd"));var s=o(a("69b7"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(s.default)}).call(this,a("bc2e")["default"],a("543d")["createPage"])},e5af:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return o}));var o={uToast:function(){return a.e("uni_modules/uview-ui/components/u-toast/u-toast").then(a.bind(null,"4bf8"))}},s=function(){var e=this.$createElement;this._self._c},n=[]},e640:function(e,t,a){"use strict";(function(e){var o=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=o(a("2eee")),n=o(a("c973")),i=a("7dcd"),r={data:function(){return{dataList:{name:"",userPhoto:""},activityId:null,inviteId:"",photoShow:!1,openCode:"",phoneCode:"",isAgree:!1,showBubble:!1,logo:"https://51xiaojingling.oss-cn-hangzhou.aliyuncs.com/51che_java_dev/20221005/a6e7ee23928f42ea897da87de5053fb0.png"}},onLoad:function(e){e.scene&&(this.inviteId=e.scene),e.activityId&&(this.activityId=e.activityId)},methods:{uploadFilePromise:function(t){return new Promise((function(a,o){e.uploadFile({url:getApp().globalData.uploadUrl,filePath:t,name:"file",formData:{user:"test"},success:function(e){setTimeout((function(){a(JSON.parse(e.data).data)}),0)}})}))},getPhoneNumber:function(e){this.phoneCode=e.detail.code,this.getopencode(e.detail.code)},OngetUserPhoto:function(e){var t=this;return(0,n.default)(s.default.mark((function a(){return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.uploadFilePromise(e.detail.avatarUrl);case 2:t.dataList.userPhoto=a.sent;case 3:case"end":return a.stop()}}),a)})))()},OnPushPrivacyPolicy:function(){e.navigateTo({url:"/pages/agreement/webview?url=https://h5.dcqcjlb.com/protocol/user_privacy.html"})},OnPushUserAgreement:function(){e.navigateTo({url:"/pages/agreement/webview?url=https://h5.dcqcjlb.com/protocol/user_service.html"})},getopencode:function(t){var a=this;e.login({provider:"weixin",onlyAuthorize:!0,success:function(e){a.openCode=e.code,a.loginNow(t,e.code,"","",0)}})},loginNow:function(t,a,o,s,n){var r=this,u=this;e.request({url:"http://coc.51api.dcqcjlb.com/coc-oauth/oauth/token",method:"POST",data:{phoneCode:t,openCode:a,avatar:o,nickName:s,grant_type:"wechat",inviteId:this.inviteId+"",activityId:this.activityId},header:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic Y29jLW1lcmNoYW50LWFwcDoxMjM0NTY="},success:function(t){console.log("输出",t),102===t.data.code?r.photoShow=!0:200==t.data.code&&r.$refs.uToast.show({message:"登录成功",type:"success",complete:function(){(0,i.setstorage)("openid",t.data.data.openid),(0,i.setstorage)("mobile",t.data.data.username),(0,i.setstorage)("register",n),(0,i.setstorage)("ishomepop",0),u.$xjlrequest.post("/user/login/get_center_tmp_token",{mobile:t.data.data.username}).then((function(t){u.$xjlrequest.post("/user/login/getXjlTokenByTmpToken",{tmp_token:t.data.access_token}).then((function(t){e.setStorageSync("xjltoken",t.data.token),e.setStorageSync("xjluserid",t.data.id)}))})),e.setStorage({key:"token",data:t.data.data.access_token,success:function(){if(u.getinfo(),"pages/activity/share/index"==getCurrentPages()[0].is)return e.switchTab({url:"/pages/home/index"}),!1;e.navigateBack({delta:1}),e.$emit("getdata")}})}})},fail:function(t){e.showToast({title:t.msg,icon:"none",duration:2e3})}})},checkboxChange:function(e){this.isAgree=!this.isAgree,this.isAgree&&(this.showBubble=!1)},upInfo:function(){this.dataList.userPhoto&&this.dataList.name&&this.isAgree?this.loginNow(this.phoneCode,this.openCode,this.dataList.userPhoto,this.dataList.name,1):this.dataList.userPhoto?this.dataList.name?this.isAgree||(this.showBubble=!0):e.showToast({title:"请设置昵称",icon:"none",duration:2e3}):e.showToast({title:"请设置头像",icon:"none",duration:2e3})},getinfo:function(){this.$request.get("/coc-my/api/v1/my/findUser").then((function(e){(0,i.setstorage)("headImg",e.data.user.headImg),(0,i.setstorage)("nickname",e.data.user.nickname),(0,i.setstorage)("userType",e.data.user.userType),(0,i.setstorage)("userId",e.data.user.id),(0,i.setstorage)("isCertify",e.data.user.isCertify),(0,i.setstorage)("realName",e.data.user.realName),(0,i.setstorage)("mobile",e.data.user.mobile),null==e.data.shop?((0,i.setstorage)("status",null),(0,i.setstorage)("shopId",null),(0,i.setstorage)("shopName",null),(0,i.setstorage)("shopTypeId",0),(0,i.setstorage)("shopType",null)):((0,i.setstorage)("status",e.data.shop.status),(0,i.setstorage)("shopId",e.data.shop.id),(0,i.setstorage)("shopName",e.data.shop.shopName),(0,i.setstorage)("shopTypeId",e.data.shop.shopTypeId),(0,i.setstorage)("shopType",e.data.shop.status))}))}}};t.default=r}).call(this,a("543d")["default"])}},[["bf81f","common/runtime","common/vendor"]]]);