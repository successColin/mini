(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/wiseman/component/addimgarticle"],{"213e":function(t,i,e){"use strict";e.d(i,"b",(function(){return n})),e.d(i,"c",(function(){return o})),e.d(i,"a",(function(){return s}));var s={uUpload:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-upload/u-upload")]).then(e.bind(null,"8f994"))},"u-Input":function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u--input/u--input")]).then(e.bind(null,"e709"))},uDivider:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(e.bind(null,"4e62"))},"u-Textarea":function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(e.bind(null,"a746"))},uIcon:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(e.bind(null,"f23e"))},uToast:function(){return e.e("uni_modules/uview-ui/components/u-toast/u-toast").then(e.bind(null,"4bf8"))},uLoadingIcon:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-loading-icon/u-loading-icon")]).then(e.bind(null,"8a2a"))},uPopup:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(e.bind(null,"076f"))}},n=function(){var t=this,i=t.$createElement,e=(t._self._c,t.fileList1.length),s=0==t.fileList2.length&&0==t.fileList1.length,n=s?null:0==t.fileList2.length&&0!=t.fileList1.length,o=0==t.fileList1.length&&0==t.fileList2.length,a=o?null:t.fileList2.length;t._isMounted||(t.e0=function(i){t.showpop=!1},t.e1=function(i){t.showvideopop=!1}),t.$mp.data=Object.assign({},{$root:{g0:e,g1:s,g2:n,g3:o,g4:a}})},o=[]},"2b9c":function(t,i,e){"use strict";(function(t){var s=e("4ea4");Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=s(e("2eee")),o=s(e("c973")),a={components:{cardauthentication:function(){e.e("components/cardauthentication").then(function(){return resolve(e("a4fb"))}.bind(null,e)).catch(e.oe)}},data:function(){return{isshowcommissionPrice:!0,topicList:[],isExpert:0,showpop:!1,shoptitle:"",shopid:"",activityid:null,activitytitle:"",groupid:null,grouptitle:"",type:null,isshow:!0,istrue:!0,showload:!1,dataList:{title:"",content:"",showType:"1",imgs:[],isInsertVote:0,votesTitle:"",duration:"",lat:"",lng:"",address:"添加地点",video:""},commissionPrice:null,citename:"",fileList2:[],isold:0,fileList1:[],showvideopop:!1}},onLoad:function(i){var e=this;i.content&&(this.dataList.content="#"+i.content),i.citeId&&(this.dataList.citeId=i.citeId,this.dataList.citeType=10,this.citename=i.citename,this.isshow=!1),i.isold&&(this.isold=1),this.isExpert=t.getStorageSync("isExpert"),t.$on("drxdrelease",(function(t){console.log(t),e.isshow=!1,0==t.commissionPrice?e.dataList.citeType=11:t.commissionPrice>0&&(e.dataList.citeType=10),e.dataList.citeId=t.citeId,e.citename=t.citename,e.commissionPrice=t.commissionPrice,e.isshowcommissionPrice=!1})),i.commissionPrice&&(e.isshowcommissionPrice=!1,e.commissionPrice=i.commissionPrice),this.gettopicList()},onShow:function(){},methods:{gettopicList:function(){var t=this;this.$request.post("/coc-social/api/v2/article/topicList").then((function(i){i.data.filter((function(i){t.topicList.push("# "+i)}))}))},previewvideo:function(){this.showvideopop=!0},OnPushshop:function(i){1==i?t.navigateTo({url:"/pages/wiseman/component/sharegoods"}):t.navigateTo({url:"/pages/wiseman/darenxiaodian/my?release=1&isCommissionPrice=0"})},Onchooseadress:function(){var i=this;t.chooseLocation({success:function(t){i.dataList.lat=t.latitude,i.dataList.lng=t.longitude,i.dataList.address=t.name}})},OnAddtalk:function(t){this.dataList.content=1==t?this.dataList.content+"#":this.dataList.content+t},OnAgain:function(){},save:function(){var i=this;"#"===this.dataList.content.charAt(0)&&(this.dataList.topic=this.dataList.content.substring(1)),this.$request.post("/coc-social/api/v2/article/add",this.dataList).then((function(e){200==e.code?(i.showload=!1,0==i.isold?i.$refs.uToast.show({message:"发布成功",type:"success",complete:function(){t.redirectTo({url:"/pages/wiseman/mywork"})}}):i.$refs.uToast.show({message:"发布成功",type:"success",complete:function(){t.redirectTo({url:"/pages/activity/activityRegistration/playfulperson"})}})):(i.showload=!1,i.istrue=!0,i.$refs.uToast.show({message:e.message,type:"error"}))}))},Onchangecover:function(){var i=this;t.chooseImage({count:1,sizeType:["original","compressed"],success:function(e){i.$newrequest.get("/coc-file/api/v1/oss/policy").then((function(s){t.uploadFile({url:"https://oss.dcqcjlb.com/",filePath:e.tempFilePaths[0],name:"file",formData:{key:s.data.dir+e.tempFilePaths[0].split("/")[2],policy:s.data.policy,OSSAccessKeyId:s.data.accessid,signature:s.data.signature,success_action_status:"200"},success:function(t){var n={coverImage:"https://oss.dcqcjlb.com/"+s.data.dir+e.tempFilePaths[0].split("/")[2],message:"",status:"success",url:i.fileList2[0].url};i.$set(i.fileList2,0,n)}})}))}})},uploadFilePromise:function(){var t=this;this.showload=!0,this.fileList1.length>0?t.dataList.imgs=[]:delete this.dataList.imgs,this.fileList1.filter((function(t,i){t.index=i}));this.fileList1.length>0?(this.fileList1.filter((function(i){t.dataList.imgs.push(i.url)})),this.save()):this.fileList2.length>0&&(t.dataList.video=this.fileList2[0].url,t.dataList.coverImage=this.fileList2[0].coverImage,this.save())},OnSend:function(){return!!this.istrue&&(console.log(this.fileList2),0==this.fileList1.length&&0==this.fileList2.length?(this.$refs.uToast.show({message:"发布贴文最少添加一张图片或视频"}),!1):this.dataList.title?1!=t.getStorageSync("isCertify")?(this.showpop=!0,!1):(this.istrue=!1,void this.uploadFilePromise()):(this.$refs.uToast.show({message:"请填写标题"}),!1))},OnChoose:function(t){this.dataList.showType=t},ondeleteimg:function(t){this.fileList1.splice(t,1)},deletePic:function(t){this["fileList".concat(t.name)].splice(t.index,1)},deletePicvideo:function(t){this.fileList2=[]},afterReadvideo:function(i){if(i.file[0].duration>30)return t.$u.toast("请将视频控制在30s内"),!1;if(i.file[0].duration<15)return t.$u.toast("视频需大于15s"),!1;var e=this;e.fileList2=[],this.showload=!0;var s="";s=i.file[0].url.split("/")[3]?i.file[0].url.split("/")[3]:i.file[0].url.split("/")[2],this.$newrequest.get("/coc-file/api/v1/oss/policy").then((function(n){t.uploadFile({url:"https://oss.dcqcjlb.com/",filePath:i.file[0].url,name:"file",formData:{key:n.data.dir+s,policy:n.data.policy,OSSAccessKeyId:n.data.accessid,signature:n.data.signature,success_action_status:"200"},success:function(t){var i={url:"https://oss.dcqcjlb.com/"+n.data.dir+s,status:"success",message:""};e.showload=!1,e.$set(e.fileList2,0,i),e.fileList2[0].coverImage="https://oss.dcqcjlb.com/"+n.data.dir+s+"?x-oss-process=video/snapshot,t_1000,m_fast"}})}))},afterRead:function(i){var e=this;return(0,o.default)(n.default.mark((function s(){var o,a;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:o=e,a=[].concat(i.file),9==e.fileList1.length&&t.$u.toast("最多上传9张图片"),e.$newrequest.get("/coc-file/api/v1/oss/policy").then((function(i){a.map((function(e,s){var n="";n=e.url.split("/")[3]?e.url.split("/")[3]:e.url.split("/")[2],t.uploadFile({url:"https://oss.dcqcjlb.com/",filePath:e.url,name:"file",formData:{key:i.data.dir+n,policy:i.data.policy,OSSAccessKeyId:i.data.accessid,signature:i.data.signature,success_action_status:"200"},success:function(t){console.log("https://oss.dcqcjlb.com/"+i.data.dir+n),o.fileList1.push({url:"https://oss.dcqcjlb.com/"+i.data.dir+n,status:"success",message:""})}})}))}));case 4:case"end":return s.stop()}}),s)})))()}}};i.default=a}).call(this,e("543d")["default"])},4440:function(t,i,e){"use strict";var s=e("d61b"),n=e.n(s);n.a},d61b:function(t,i,e){},dc84:function(t,i,e){"use strict";e.r(i);var s=e("213e"),n=e("fcdc");for(var o in n)["default"].indexOf(o)<0&&function(t){e.d(i,t,(function(){return n[t]}))}(o);e("4440");var a=e("f0c5"),c=Object(a["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);i["default"]=c.exports},f685:function(t,i,e){"use strict";(function(t,i){var s=e("4ea4");e("4319");s(e("66fd"));var n=s(e("dc84"));t.__webpack_require_UNI_MP_PLUGIN__=e,i(n.default)}).call(this,e("bc2e")["default"],e("543d")["createPage"])},fcdc:function(t,i,e){"use strict";e.r(i);var s=e("2b9c"),n=e.n(s);for(var o in s)["default"].indexOf(o)<0&&function(t){e.d(i,t,(function(){return s[t]}))}(o);i["default"]=n.a}},[["f685","common/runtime","common/vendor"]]]);