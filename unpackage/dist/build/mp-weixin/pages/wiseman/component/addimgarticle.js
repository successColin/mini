require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/wiseman/component/addimgarticle"],{"419c":function(t,e,i){"use strict";i.r(e);var s=i("52ac"),n=i("4868");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("fa9f");var a=i("f0c5"),c=Object(a["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);e["default"]=c.exports},4868:function(t,e,i){"use strict";i.r(e);var s=i("b12f"),n=i.n(s);for(var o in s)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(o);e["default"]=n.a},"52ac":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return s}));var s={uUpload:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-upload/u-upload")]).then(i.bind(null,"9a59"))},"u-Input":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--input/u--input")]).then(i.bind(null,"c00c"))},uDivider:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(i.bind(null,"944a"))},"u-Textarea":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(i.bind(null,"f44e"))},uIcon:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(i.bind(null,"0f14"))},uSwitch:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-switch/u-switch")]).then(i.bind(null,"df2d"))},uToast:function(){return i.e("uni_modules/uview-ui/components/u-toast/u-toast").then(i.bind(null,"1b13"))},uPopup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(i.bind(null,"8add"))},uModal:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-modal/u-modal")]).then(i.bind(null,"ba5d"))},uButton:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-button/u-button")]).then(i.bind(null,"bfa6"))}},n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.fileList1.length),s=0==t.fileList2.length&&0==t.fileList1.length&&t.isShowUploadImg,n=s?null:0==t.fileList2.length&&0!=t.fileList1.length&&t.isShowUploadImg,o=0==t.fileList1.length&&0==t.fileList2.length&&!t.coverImg,a=o?null:1==t.fileList2.length&&t.coverImg,c=t.__get_style([100==t.percentage&&t.videoUrl?{background:"#D91b1b",color:"#ffffff"}:""]);t._isMounted||(t.e0=function(e){t.showpop=!1},t.e1=function(e){t.showvideopop=!1}),t.$mp.data=Object.assign({},{$root:{g0:i,g1:s,g2:n,g3:o,g4:a,s0:c}})},o=[]},"56f2":function(t,e,i){"use strict";(function(t,e){var s=i("4ea4");i("76b1");s(i("66fd"));var n=s(i("419c"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},b12f:function(t,e,i){"use strict";(function(t){var s=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i("2eee")),o=s(i("c973")),a=i("04ff"),c={components:{cardauthentication:function(){i.e("components/cardauthentication").then(function(){return resolve(i("fc50"))}.bind(null,i)).catch(i.oe)}},data:function(){return{videoTime:0,videoUrl:"",coverImageType:2,mustTalent:!1,masterShow:!1,showLoading:!1,percentage:0,totalPercentage:0,isshowcommissionPrice:!0,topicList:[],isExpert:0,showpop:!1,shoptitle:"",shopid:"",activityid:null,activitytitle:"",groupid:null,grouptitle:"",type:null,isshow:!0,istrue:!0,showload:!1,dataList:{title:"",content:"",showType:"1",imgs:[],isInsertVote:0,votesTitle:"",duration:"",lat:"",lng:"",address:"添加地点",video:"",shopPunchClock:"",shopPunchClockId:"",isOriginal:1},commissionPrice:null,citename:"",fileList2:[],isold:0,fileList1:[],showvideopop:!1,newType:0,tablist:[],pageType:10,isShowUploadImg:!0,coverImg:""}},onLoad:function(e){var i=this;e.isShowUploadImg&&(this.isShowUploadImg=JSON.parse(e.isShowUploadImg)),e.type&&(this.pageType=e.type),e.mustTalent&&(this.mustTalent=e.mustTalent),e.content&&(this.dataList.content="#"+e.content),e.citeId&&(this.dataList.citeId=e.citeId,this.dataList.citeType=10,this.citename=e.citename,this.isshow=!1),e.isold&&(this.isold=1),e.newType&&(this.newType=1*e.newType,this.dataList.newType=1*e.newType,this.isold=1),this.getIsExpert(),t.$on("drxdrelease",(function(t){console.log(t),i.isshow=!1,0==t.commissionPrice?i.dataList.citeType=11:t.commissionPrice>0&&(i.dataList.citeType=10),i.dataList.citeId=t.citeId,i.citename=t.citename,i.commissionPrice=t.commissionPrice,i.isshowcommissionPrice=!1})),e.commissionPrice&&(i.isshowcommissionPrice=!1,i.commissionPrice=e.commissionPrice),this.gettopicList(),this.getTabsList(),t.$on("getCover",(function(t){i.giveParams(t)}))},destroyed:function(){t.$off("getCover")},onShow:function(){},computed:{isShowAddressTitle:function(){return!(this.dataList.address||this.dataList.shopPunchClock||this.dataList.shopPunchClockId)},coverParams:function(){if(this.videoUrl)return"/pages/wiseman/component/coverImg?time=".concat(this.videoTime,"&url=").concat(this.videoUrl)}},watch:{coverImg:function(t){this.showLoading=!t}},methods:{handleJumpXuzhi:function(){t.navigateTo({url:"/pages/home/webview?myUrl=https://m.dcqcjlb.com/pages/agreement/originalStatement/index"})},giveParams:function(t){var e=JSON.parse(JSON.stringify(t));console.log(e),this.coverImg=e.showImage,this.coverImageType=e.coverImageType},getIsExpert:function(){var t=this;return(0,o.default)(n.default.mark((function e(){var i;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=(0,a.tologin)(),!i){e.next=4;break}return e.next=4,t.$request.post("/coc-active/api/v1/my/index").then((function(e){(0,a.setstorage)("isExpert",e.data.isExpert),t.isExpert=e.data.isExpert,1!=e.data.isExpert&&t.mustTalent&&(t.masterShow=!0)}));case 4:case"end":return e.stop()}}),e)})))()},otherFun:function(t,e){e&&(this.dataList.shopPunchClock=t,this.dataList.shopPunchClockId=e,this.dataList.address="")},handleMerchant:function(){t.navigateTo({url:"/pages/wiseman/xuanpinguangchang/merchantPunch"})},getTabsList:function(){var t=this;return(0,o.default)(n.default.mark((function e(){var i,s,o;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$request.post("/coc-system/api/v1/system/base_info/list",{type:t.pageType});case 2:i=e.sent,s=i.data,o=[],s.forEach((function(t){o.push({value:t.id,label:t.title,status:!1})})),t.tablist=o;case 7:case"end":return e.stop()}}),e)})))()},setTabsList:function(t){this.tablist.forEach((function(e){JSON.stringify(e)===JSON.stringify(t)?e.status=!0:e.status=!1})),this.dataList.entertainmentSiftCategoryId=t.value},handleUpgrades:function(){console.log("去升级"),t.navigateTo({url:"/pages/wiseman/welcome"})},closeModal:function(){t.navigateBack({delta:1})},gettopicList:function(){var t=this;this.$request.post("/coc-system/api/v1/system/article/topic/list",{newType:this.newType,current:1,size:100}).then((function(e){e.data.forEach((function(e){t.topicList.push("# "+e.topic)}))}))},previewvideo:function(){this.showvideopop=!0},OnPushshop:function(e){1==e?t.navigateTo({url:"/pages/wiseman/component/sharegoods"}):t.navigateTo({url:"/pages/wiseman/darenxiaodian/my?release=1&isCommissionPrice=0"})},Onchooseadress:function(){var e=this;t.chooseLocation({success:function(t){console.log(t),e.dataList.lat=t.latitude,e.dataList.lng=t.longitude,e.dataList.address=t.name}})},OnAddtalk:function(t){this.dataList.content=1==t?this.dataList.content+"#":this.dataList.content+t},OnAgain:function(){},save:function(){var e=this;"#"===this.dataList.content.charAt(0)&&(this.dataList.topic=this.dataList.content.substring(1)),this.$request.post("/coc-social/api/v2/article/add",this.dataList).then((function(i){200==i.code?(e.showload=!1,0==e.isold?e.$refs.uToast.show({message:"发布成功",type:"success",complete:function(){t.redirectTo({url:"/pages/wiseman/mywork"})}}):2===e.newType?e.$refs.uToast.show({message:"发布成功",type:"success",complete:function(){t.redirectTo({url:"/pages/advertisement/choice"})}}):3===e.newType||1===e.newType?e.$refs.uToast.show({message:"发布成功",type:"success",complete:function(){var e=getCurrentPages(),i=e[e.length-2];i.$vm.tosearch(),t.navigateBack()}}):e.$refs.uToast.show({message:"发布成功",type:"success",complete:function(){t.redirectTo({url:"/pages/activity/activityRegistration/playfulperson"})}})):(e.showload=!1,e.istrue=!0,e.$refs.uToast.show({message:i.message,type:"error"}))}))},Onchangecover:function(){t.navigateTo({url:this.coverParams})},uploadFilePromise:function(){var t=this;this.showload=!0,this.fileList1.length>0?t.dataList.imgs=[]:delete this.dataList.imgs,this.fileList1.filter((function(t,e){t.index=e}));this.fileList1.length>0?(this.fileList1.filter((function(e){t.dataList.imgs.push(e.url)})),this.save()):this.fileList2.length>0&&(t.dataList.video=this.fileList2[0].url,t.dataList.coverImage=this.coverImg,t.dataList.coverImageType=this.coverImageType,this.save())},OnSend:function(){return!!this.istrue&&(console.log(this.fileList2),0==this.fileList1.length&&0==this.fileList2.length?(this.$refs.uToast.show({message:"发布贴文最少添加一张图片或视频"}),!1):this.dataList.title?1!=t.getStorageSync("isCertify")?(this.showpop=!0,!1):(this.istrue=!1,void this.uploadFilePromise()):(this.$refs.uToast.show({message:"请填写标题"}),!1))},OnChoose:function(t){this.dataList.showType=t},ondeleteimg:function(t){this.fileList1.splice(t,1)},deletePic:function(t){this["fileList".concat(t.name)].splice(t.index,1)},deletePicvideo:function(t){this.fileList2=[]},handleBeforeRead:function(e){return this.showLoading=!0,this.videoTime=e.file[0].duration,e.file[0].size/1024/1024>500?(t.$u.toast("视频大小不能超过500mb"),!1):e.file[0].duration>300?(t.$u.toast("请将视频控制在5分钟内"),!1):e.file[0].duration<15?(t.$u.toast("视频需大于15s"),!1):void 0},afterReadvideo:function(e){var i=this;console.log(e),this.videoTime=e.file[0].duration;var s=this;s.fileList2=[],this.showload=!0;var n=e.file[0].url.split("."),o=(new Date).getTime(),a=Math.floor(100*Math.random())+1,c=o+a+"."+n[1];this.$newrequest.get("/coc-file/api/v1/oss/policy").then((function(n){console.log(n,c),t.uploadFile({url:"https://51shanky.oss-cn-hangzhou.aliyuncs.com/",filePath:e.file[0].url,name:"file",formData:{key:n.data.dir+c,policy:n.data.policy,OSSAccessKeyId:n.data.accessid,signature:n.data.signature,success_action_status:"200"},success:function(t){console.log(t);var e={url:"https://oss.dcqcjlb.com/"+n.data.dir+c,status:"success",message:""};s.percentage=100,s.showload=!1,s.videoUrl=e.url,s.$set(s.fileList2,0,e),s.coverImg="",s.coverImageType=""}}).onProgressUpdate((function(t){i.showLoading=!0,i.percentage=t.progress<99?t.progress:99,i.totalPercentage=Math.trunc(t.totalBytesExpectedToSend/1e6)}))}))},afterRead:function(e){var i=this;return(0,o.default)(n.default.mark((function s(){var o,a;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:o=i,a=[].concat(e.file),9==i.fileList1.length&&t.$u.toast("最多上传9张图片"),i.$newrequest.get("/coc-file/api/v1/oss/policy").then((function(e){a.map((function(i,s){var n="";n=i.url.split("/")[3]?i.url.split("/")[3]:i.url.split("/")[2],t.uploadFile({url:"https://oss.dcqcjlb.com/",filePath:i.url,name:"file",formData:{key:e.data.dir+n,policy:e.data.policy,OSSAccessKeyId:e.data.accessid,signature:e.data.signature,success_action_status:"200"},success:function(t){console.log("https://oss.dcqcjlb.com/"+e.data.dir+n),o.fileList1.push({url:"https://oss.dcqcjlb.com/"+e.data.dir+n,status:"success",message:""})}})}))}));case 4:case"end":return s.stop()}}),s)})))()},handleJump:function(){console.log(this.percentage),100==this.percentage&&(console.log(this.coverParams,this.videoUrl),t.navigateTo({url:this.coverParams}))}}};e.default=c}).call(this,i("543d")["default"])},bdd0:function(t,e,i){},fa9f:function(t,e,i){"use strict";var s=i("bdd0"),n=i.n(s);n.a}},[["56f2","common/runtime","common/vendor"]]]);