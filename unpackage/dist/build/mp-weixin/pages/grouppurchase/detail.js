(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/grouppurchase/detail"],{"2b64":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i("04ff"),a={components:{carousel:function(){Promise.all([i.e("common/vendor"),i.e("components/carousel/index")]).then(function(){return resolve(i("7662"))}.bind(null,i)).catch(i.oe)},Poster:function(){i.e("components/zhangyuhao-poster/Poster").then(function(){return resolve(i("8293"))}.bind(null,i)).catch(i.oe)},commission:function(){i.e("components/commission/index").then(function(){return resolve(i("d371"))}.bind(null,i)).catch(i.oe)},joinshopbtn:function(){i.e("components/joinshopbtn/index").then(function(){return resolve(i("ba8e"))}.bind(null,i)).catch(i.oe)},recommendX:function(){Promise.all([i.e("common/vendor"),i.e("components/darenRecommend/recommendX")]).then(function(){return resolve(i("9dd0"))}.bind(null,i)).catch(i.oe)},floatVideo:function(){Promise.all([i.e("common/vendor"),i.e("components/floatVideo/index")]).then(function(){return resolve(i("954c"))}.bind(null,i)).catch(i.oe)},detailEvaluate:function(){Promise.all([i.e("common/vendor"),i.e("components/evaluate/detailEvaluate")]).then(function(){return resolve(i("27ef"))}.bind(null,i)).catch(i.oe)}},data:function(){return{poster:"",list:[],token:null,isExpert:null,bankCardPrice:0,surplusStock:0,currentflashSalePrice:0,currentstock:0,radiovalue1:"",rules:{name:{type:"string",required:!0,message:"请填写姓名",trigger:["blur","change"]},mobile:[{required:!0,message:"请输入手机号",trigger:["change","blur"]},{validator:function(t,i,n){return e.$u.test.mobile(i)},message:"手机号码不正确",trigger:["change","blur"]}]},signuodata:{name:"",mobile:""},isshowpage:!1,currentmeal:null,showpop:!1,istimeend:!0,safeHeight:0,timeData:{},autoPlay:!1,swiperList:[],dataList:{},openpop:!1,id:"",posterShareUrl:"",option:{},showpopshare:!1,choosemealdata:{},showsignup:!1,forwardUserId:null,isapp:0,iscommission:0,commentList:[],commentInfo:{}}},onLoad:function(t){var i=this;t.enter&&e.setStorageSync("enter",t.enter),t.scene&&t.scene.indexOf("_enter=117")&&e.setStorageSync("enter","117"),t.isapp&&(this.isapp=1),t.id&&(this.id=t.id),t.forwardUserId&&(this.forwardUserId=t.forwardUserId,e.getStorageSync("token")?e.getStorageSync("token")&&1!=e.getStorageSync("isExpert")&&this.tempparentid():(0,n.tologin)()),t.scene&&(this.id=t.scene.split("_")[0],this.forwardUserId=t.scene.split("_")[1],e.getStorageSync("token")?e.getStorageSync("token")&&1!=e.getStorageSync("isExpert")&&this.tempparentid():(0,n.tologin)()),this.forwardUserId||(this.forwardUserId=(0,n.getstorage)("userId")),this.token=e.getStorageSync("token"),this.isExpert=e.getStorageSync("isExpert"),this.getList(),t.iscommission&&(this.iscommission=t.iscommission),e.$on("saveaddshop",(function(e){i.getList()}))},onUnload:function(){1==this.isapp&&(window._51club&&window._51club.backIntercept("app"),window.webkit.messageHandlers&&window.webkit.messageHandlers.backIntercept.postMessage("app"))},onShareAppMessage:function(t){if(!e.getStorageSync("token"))return(0,n.tologin)(),!1;var i=this.dataList.title,a=this.dataList.appletsSharePic?this.dataList.appletsSharePic:this.dataList.coverPicture;return{title:i,path:"/pages/grouppurchase/detail?forwardUserId="+this.forwardUserId+"&id="+this.id+"&enter=117",imageUrl:a}},onShareTimeline:function(t){if(!e.getStorageSync("token"))return(0,n.tologin)(),!1;var i=this.dataList.title,a=this.dataList.appletsSharePic?this.dataList.appletsSharePic:this.dataList.coverPicture;return{title:i,path:"/pages/grouppurchase/detail?forwardUserId="+this.forwardUserId+"&id="+this.id+"&enter=117",imageUrl:a}},onShow:function(){this.signuodata.mobile=(0,n.getstorage)("mobile"),this.forwardUserId&&e.getStorageSync("token")&&this.tempparentid(),this.getList(),this.getComments()},computed:{height:function(){return"calc(100vh - 42px - 48rpx - ".concat(this.safeHeight,"px)")},getadUrl:function(){return!!this.dataList.adUrl}},onReady:function(){var t=this;this.$refs.uForm.setRules(this.rules),e.createSelectorQuery().in(this).select(".safe-bottom-height").boundingClientRect((function(e){t.safeHeight=e.height})).exec()},methods:{tempparentid:function(){this.$request.post("/coc-active/api/v1/invite/temp_parent_id/add",{tempParentId:this.forwardUserId}).then((function(e){}))},Oncopy:function(t){e.setClipboardData({data:t,success:function(){e.$u.toast("复制成功")}})},posterSuccess:function(e){this.poster=e},OnSaveImage:function(){var t=[this.poster];e.previewImage({current:99999,urls:t,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}})},handleComment:function(){var t={commentType:6,id:this.id,shopName:this.dataList.shopName};e.navigateTo({url:"/pages/service/evaluate/writeEvaluate?info="+JSON.stringify(t)})},addClue:function(){var t=this;if(!this.radiovalue1)return e.$u.toast("请同意并阅读个人信息保护声明"),!1;this.$refs.uForm.validate().then((function(i){t.$newrequest.post("/coc-active/api/v1/sign_up/not/designated/user/addClue",{correlationId:t.id,mobile:t.signuodata.mobile,name:t.signuodata.name,type:"2"}).then((function(i){200==i.code?(e.$u.toast("预约成功"),t.showsignup=!1):e.$u.toast(i.message)}))}))},OnPushPrivacyPolicy:function(){e.navigateTo({url:"/pages/agreement/webview?url=https://h5.dcqcjlb.com/protocol/user_vehicle_consultation.html"})},closesignup:function(){this.showsignup=!1},OnCloseShare:function(){this.showpopshare=!1},popposter:function(){var t=this;if(!e.getStorageSync("token"))return(0,n.tologin)(),!1;this.$request.post("/coc-active/api/v1/invite/getMiniProgramQrCode",{page:"pages/grouppurchase/detail",scene:this.id+"_"+this.forwardUserId+"_enter=117"}).then((function(e){t.showpopshare=!0,t.list=[{type:"image",path:t.dataList.posterFigureUrl,x:0,y:0,width:443,height:787},{type:"image",path:e.data.qrCode,x:18,y:682,width:90,height:90}],t.$nextTick((function(){t.$refs.poster.create()}))}))},isnext:function(){var t=this;1==this.dataList.isDesignated?this.$newrequest.post("/coc-active/api/v1/sign_up/designated/user/canBuy",{activityId:this.id,type:"2"}).then((function(i){200==i.code?0==i.data?t.showsignup=!0:t.showpop=!0:e.showToast({icon:"none",title:i.message})})):this.showpop=!0},Onopen:function(){var t=this;!0===(0,n.tologin)()&&(this.dataList.skuCoding?this.$request.post("/coc-active/api/v1/payment/preference/userIsCanBuyProduct",{activityPaymentPreferenceId:this.dataList.activityPaymentPreferenceId,goodsId:this.dataList.id,type:2}).then((function(i){200==i.code?1==i.data.isCanBuy?t.isnext():0==i.data.isCanBuy&&e.$u.toast("您本月已享受该优惠，暂不可购买"):e.$u.toast(i.message)})):this.isnext())},Onaddcollections:function(){(0,n.tologin)(),2==this.dataList.isCollection?this.dataList.isCollection=1:this.dataList.isCollection=2,(0,n.getstorage)("token")&&this.$request.post("/coc-active/api/v1/collections/add_collections",{type:"3",relId:this.dataList.id,relName:this.dataList.shopName,activityMoney:this.dataList.flashSalePrice}).then((function(e){if(200==e.code);}))},Onsingup:function(){var t=this;return null==this.currentmeal&&0!=this.currentmeal?(e.showToast({icon:"none",title:"请选择一个套餐~"}),!1):this.choosemealdata.stock-this.choosemealdata.saleNum<=0?(e.showToast({icon:"none",title:"库存已抢光"}),!1):void e.navigateTo({url:"/pages/grouppurchase/payindex?istype=wx&forwardUserId="+this.forwardUserId,success:function(e){e.eventChannel.emit("getinfo",{data:t.dataList}),t.showpop=!1}})},choosemeal:function(e,t){this.currentflashSalePrice=e.flashSalePrice,this.currentstock=e.stock-e.saleNum,this.dataList.groupPurchaseSetMealId=e.id,this.dataList.mealname=e.name,this.dataList.mealprice=e.flashSalePrice,this.currentmeal=t,this.choosemealdata=e,this.bankCardPrice=e.flashSalePrice-e.bankCardPrice},OnPushshopHome:function(){e.navigateTo({url:"/pages/activityMall/business/index?id="+this.dataList.shopId})},OnPushMap:function(){e.openLocation({latitude:this.dataList.lat,longitude:this.dataList.lng,success:function(){console.log("success")}})},onChange:function(e){this.timeData=e,0==e.days&&0==e.hours&&0==e.minutes&&0==e.seconds&&(this.istimeend=!1)},Oncard:function(t){1==t?e.navigateTo({url:"/pages/carShops/upkeep/insurance?id=0"}):2==t?e.navigateTo({url:"/pages/my/creditCard/detail?type=n"}):3==t?e.navigateTo({url:"/pages/my/creditCard/detail?type=g"}):4==t&&e.navigateTo({url:"/pages/my/creditCard/detail?type=y"}),this.openpop=!1},getswiper:function(){return this.swiperList},getcode:function(t){e.uploadFile({url:getApp().globalData.uploadUrl,filePath:t.data.appletsCode,name:"file",formData:{file:t.data.appletsCode},header:{"Content-Type":"multipart/form-data"},success:function(e){console.log(JSON.parse(e.data).data)}})},getList:function(){var e=this;this.isshowpage||this.$showLoading(),this.$newrequest.get("/coc-active/api/v1/group/getDetails/"+this.id).then((function(t){t.data.groupDetailsMealVOS.filter((function(t){e.surplusStock+=t.stock-t.saleNum})),e.bankCardPrice=t.data.flashSalePrice-t.data.bankCardPrice,e.currentflashSalePrice=t.data.flashSalePrice,e.currentstock=t.data.stock,e.getcode(t),e.option={marketPrice:t.data.marketPrice,flashSalePrice:t.data.bankCardPrice?t.data.bankCardPrice:t.data.flashSalePrice,codeUrl:t.data.qrCode,signUpEndTimeStr:t.data.expirationTime,coverUrl:t.data.coverPicture,headUrl:"https://oss.dcqcjlb.com/51che_java_dev/20221201/ee67baa9692a4ec2a2d1f3141fb3b649.png",bgUrl:"https://oss.dcqcjlb.com/51che_java_dev/20221201/ee67baa9692a4ec2a2d1f3141fb3b649.png",fillStyle:"#0688ff",nickName:"",miniName:"",tkName:t.data.title,tkAuthor:"内容",tkType:"考试",cost:"免费",isPub:"公开"};var i=[];if(t.data.adUrl){var n=t.data.adUrl.split(",");n.forEach((function(e){i.push({url:e,type:"image"})}))}t.data.adPushUrl?(i.unshift({url:t.data.adPushUrl,type:"video",poster:t.data.adCoverImg?t.data.adCoverImg:""}),e.autoPlay=!1):e.autoPlay=!0,e.choosemealdata=t.data.groupDetailsMealVOS[0],e.swiperList=i,e.dataList=t.data,e.dataList.groupPurchaseSetMealId=t.data.groupDetailsMealVOS[0].id,e.dataList.mealname=t.data.groupDetailsMealVOS[0].name,e.dataList.mealprice=t.data.groupDetailsMealVOS[0].flashSalePrice})).catch((function(e){})).finally((function(){e.isshowpage||(e.isshowpage=!0,e.$hideLoading())}))},submitAppoint:function(){var t=this;!0===(0,n.tologin)()&&this.$newrequest.post("/coc-active/api/v1/group/appointment",{id:this.id}).then((function(i){200==i.code?(t.dataList.isAppointment=1,e.showToast({icon:"none",title:"预约成功"})):e.showToast({icon:"none",title:i.message})}))},getComments:function(){var e=this;this.$newrequest.post("/coc-system/api/v1/user_interaction/getComment",{id:this.id,commentType:6,current:1,size:10}).then((function(t){t.data.total>0&&(t.data.records.forEach((function(e){null!=e.imgs&&""!=e.imgs&&(e.imgs=e.imgs.split(","))})),e.commentList=t.data.records,e.commentInfo={id:e.id,commentType:6,listNum:t.data.total})}))}}};t.default=a}).call(this,i("543d")["default"])},3967:function(e,t,i){"use strict";var n=i("4139"),a=i.n(n);a.a},4139:function(e,t,i){},"5a2c":function(e,t,i){"use strict";(function(e,t){var n=i("4ea4");i("76b1");n(i("66fd"));var a=n(i("e371"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(a.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},"6fe0":function(e,t,i){"use strict";i.r(t);var n=i("2b64"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"8ec9":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var n={uCountDown:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-count-down/u-count-down")]).then(i.bind(null,"cda7"))},uParse:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(i.bind(null,"b3af"))},uPopup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(i.bind(null,"8add"))},uDivider:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(i.bind(null,"944a"))},"u-Form":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--form/u--form")]).then(i.bind(null,"f093"))},uFormItem:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(i.bind(null,"ee1b"))},"u-Input":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--input/u--input")]).then(i.bind(null,"c00c"))},uRadioGroup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio-group/u-radio-group")]).then(i.bind(null,"8f9f"))},uRadio:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio/u-radio")]).then(i.bind(null,"37f9"))}},a=function(){var e=this,t=e.$createElement,i=(e._self._c,e.isshowpage&&e.getadUrl?e.getswiper():null),n=e.isshowpage?e.commentList.length:null,a=e.dataList.bankCardPrice>0&&e.bankCardPrice.toFixed(2)>0,o=a&&6==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,s=a&&5==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,r=a&&7==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,c=a&&8==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,u=a&&10==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null;e._isMounted||(e.e0=function(t){e.showpop=!1}),e.$mp.data=Object.assign({},{$root:{m0:i,g0:n,g1:a,g2:o,g3:s,g4:r,g5:c,g6:u}})},o=[]},e371:function(e,t,i){"use strict";i.r(t);var n=i("8ec9"),a=i("6fe0");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("3967");var s=i("f0c5"),r=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=r.exports}},[["5a2c","common/runtime","common/vendor"]]]);