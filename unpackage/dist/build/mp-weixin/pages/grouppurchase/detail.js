(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/grouppurchase/detail"],{"1fab":function(e,t,i){"use strict";var a=i("bfd1"),n=i.n(a);n.a},"93fe":function(e,t,i){"use strict";i.r(t);var a=i("c6fa"),n=i.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);t["default"]=n.a},a30c:function(e,t,i){"use strict";(function(e,t){var a=i("4ea4");i("4319");a(i("66fd"));var n=a(i("ce6e"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},b93a:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return a}));var a={uCountDown:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-count-down/u-count-down")]).then(i.bind(null,"e517"))},uParse:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(i.bind(null,"5dcf"))},uPopup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(i.bind(null,"076f"))},uDivider:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(i.bind(null,"4e62"))},"u-Form":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--form/u--form")]).then(i.bind(null,"4b8f"))},uFormItem:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(i.bind(null,"4019"))},"u-Input":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--input/u--input")]).then(i.bind(null,"e709"))},uRadioGroup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio-group/u-radio-group")]).then(i.bind(null,"35d2"))},uRadio:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio/u-radio")]).then(i.bind(null,"df92"))}},n=function(){var e=this,t=e.$createElement,i=(e._self._c,e.isshowpage&&e.getadUrl?e.getswiper():null),a=e.dataList.bankCardPrice>0&&6==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,n=e.dataList.bankCardPrice>0&&5==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,o=e.dataList.bankCardPrice>0&&7==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,s=e.dataList.bankCardPrice>0&&8==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,r=e.dataList.bankCardPrice>0&&10==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null;e._isMounted||(e.e0=function(t){e.showpop=!1}),e.$mp.data=Object.assign({},{$root:{m0:i,g0:a,g1:n,g2:o,g3:s,g4:r}})},o=[]},bfd1:function(e,t,i){},c6fa:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i("7dcd"),n={components:{carousel:function(){Promise.all([i.e("common/vendor"),i.e("components/carousel/index")]).then(function(){return resolve(i("c969"))}.bind(null,i)).catch(i.oe)},Poster:function(){i.e("components/zhangyuhao-poster/Poster").then(function(){return resolve(i("dce9"))}.bind(null,i)).catch(i.oe)},commission:function(){i.e("components/commission/index").then(function(){return resolve(i("c47e"))}.bind(null,i)).catch(i.oe)},joinshopbtn:function(){i.e("components/joinshopbtn/index").then(function(){return resolve(i("28c1"))}.bind(null,i)).catch(i.oe)}},data:function(){return{poster:"",list:[],token:null,isExpert:null,bankCardPrice:0,surplusStock:0,currentflashSalePrice:0,currentstock:0,radiovalue1:"",rules:{name:{type:"string",required:!0,message:"请填写姓名",trigger:["blur","change"]},mobile:[{required:!0,message:"请输入手机号",trigger:["change","blur"]},{validator:function(t,i,a){return e.$u.test.mobile(i)},message:"手机号码不正确",trigger:["change","blur"]}]},signuodata:{name:"",mobile:""},isshowpage:!1,currentmeal:null,showpop:!1,istimeend:!0,safeHeight:0,timeData:{},autoPlay:!1,swiperList:[],dataList:{},openpop:!1,id:"",posterShareUrl:"",option:{},showpopshare:!1,choosemealdata:{},showsignup:!1,forwardUserId:null,isapp:0,iscommission:0}},onLoad:function(t){var i=this;t.isapp&&(this.isapp=1),t.id&&(this.id=t.id),t.forwardUserId&&(this.forwardUserId=t.forwardUserId,e.getStorageSync("token")?e.getStorageSync("token")&&1!=e.getStorageSync("isExpert")&&this.tempparentid():(0,a.tologin)()),t.scene&&(this.id=t.scene.split("_")[0],this.forwardUserId=t.scene.split("_")[1],e.getStorageSync("token")?e.getStorageSync("token")&&1!=e.getStorageSync("isExpert")&&this.tempparentid():(0,a.tologin)()),this.forwardUserId||(this.forwardUserId=(0,a.getstorage)("userId")),this.token=e.getStorageSync("token"),this.isExpert=e.getStorageSync("isExpert"),this.getList(),t.iscommission&&(this.iscommission=t.iscommission),e.$on("saveaddshop",(function(e){i.getList()}))},onUnload:function(){1==this.isapp&&(window._51club&&window._51club.backIntercept("app"),window.webkit.messageHandlers&&window.webkit.messageHandlers.backIntercept.postMessage("app"))},onShareAppMessage:function(t){if(!e.getStorageSync("token"))return(0,a.tologin)(),!1;var i=this.dataList.title,n=this.dataList.appletsSharePic?this.dataList.appletsSharePic:this.dataList.coverPicture;return{title:i,path:"/pages/grouppurchase/detail?forwardUserId="+this.forwardUserId+"&id="+this.id,imageUrl:n}},onShareTimeline:function(t){if(!e.getStorageSync("token"))return(0,a.tologin)(),!1;var i=this.dataList.title,n=this.dataList.appletsSharePic?this.dataList.appletsSharePic:this.dataList.coverPicture;return{title:i,path:"/pages/grouppurchase/detail?forwardUserId="+this.forwardUserId+"&id="+this.id,imageUrl:n}},onShow:function(){this.signuodata.mobile=(0,a.getstorage)("mobile"),this.forwardUserId&&e.getStorageSync("token")&&this.tempparentid(),this.getList()},computed:{height:function(){return"calc(100vh - 42px - 48rpx - ".concat(this.safeHeight,"px)")},getadUrl:function(){return!!this.dataList.adUrl}},onReady:function(){var t=this;this.$refs.uForm.setRules(this.rules),e.createSelectorQuery().in(this).select(".safe-bottom-height").boundingClientRect((function(e){t.safeHeight=e.height})).exec()},methods:{tempparentid:function(){this.$request.post("/coc-active/api/v1/invite/temp_parent_id/add",{tempParentId:this.forwardUserId}).then((function(e){}))},Oncopy:function(t){e.setClipboardData({data:t,success:function(){e.$u.toast("复制成功")}})},posterSuccess:function(e){this.poster=e},OnSaveImage:function(){var t=[this.poster];e.previewImage({current:99999,urls:t,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}})},addClue:function(){var t=this;if(!this.radiovalue1)return e.$u.toast("请同意并阅读个人信息保护声明"),!1;this.$refs.uForm.validate().then((function(i){t.$newrequest.post("/coc-active/api/v1/sign_up/not/designated/user/addClue",{correlationId:t.id,mobile:t.signuodata.mobile,name:t.signuodata.name,type:"2"}).then((function(i){200==i.code?(e.$u.toast("预约成功"),t.showsignup=!1):e.$u.toast(i.message)}))}))},OnPushPrivacyPolicy:function(){e.navigateTo({url:"/pages/agreement/webview?url=https://h5.dcqcjlb.com/protocol/user_vehicle_consultation.html"})},closesignup:function(){this.showsignup=!1},OnCloseShare:function(){this.showpopshare=!1},popposter:function(){var t=this;if(!e.getStorageSync("token"))return(0,a.tologin)(),!1;this.$request.post("/coc-active/api/v1/invite/getMiniProgramQrCode",{page:"pages/grouppurchase/detail",scene:this.id+"_"+this.forwardUserId}).then((function(e){t.showpopshare=!0,t.list=[{type:"image",path:t.dataList.posterFigureUrl,x:0,y:0,width:443,height:787},{type:"image",path:e.data.qrCode,x:18,y:682,width:90,height:90}],t.$nextTick((function(){t.$refs.poster.create()}))}))},isnext:function(){var t=this;1==this.dataList.isDesignated?this.$newrequest.post("/coc-active/api/v1/sign_up/designated/user/canBuy",{activityId:this.id,type:"2"}).then((function(i){200==i.code?0==i.data?t.showsignup=!0:t.showpop=!0:e.showToast({icon:"none",title:i.message})})):this.showpop=!0},Onopen:function(){var t=this;!0===(0,a.tologin)()&&(this.dataList.skuCoding?this.$request.post("/coc-active/api/v1/payment/preference/userIsCanBuyProduct",{activityPaymentPreferenceId:this.dataList.activityPaymentPreferenceId,goodsId:this.dataList.id,type:2}).then((function(i){200==i.code?1==i.data.isCanBuy?t.isnext():0==i.data.isCanBuy&&e.$u.toast("您本月已享受该优惠，暂不可购买"):e.$u.toast(i.message)})):this.isnext())},Onaddcollections:function(){(0,a.tologin)(),2==this.dataList.isCollection?this.dataList.isCollection=1:this.dataList.isCollection=2,(0,a.getstorage)("token")&&this.$request.post("/coc-active/api/v1/collections/add_collections",{type:"3",relId:this.dataList.id,relName:this.dataList.shopName,activityMoney:this.dataList.flashSalePrice}).then((function(e){if(200==e.code);}))},Onsingup:function(){var t=this;return null==this.currentmeal&&0!=this.currentmeal?(e.showToast({icon:"none",title:"请选择一个套餐~"}),!1):this.choosemealdata.stock-this.choosemealdata.saleNum<=0?(e.showToast({icon:"none",title:"库存已抢光~"}),!1):void e.navigateTo({url:"/pages/grouppurchase/payindex?istype=wx&forwardUserId="+this.forwardUserId,success:function(e){e.eventChannel.emit("getinfo",{data:t.dataList}),t.showpop=!1}})},choosemeal:function(e,t){this.currentflashSalePrice=e.flashSalePrice,this.currentstock=e.stock-e.saleNum,this.dataList.groupPurchaseSetMealId=e.id,this.dataList.mealname=e.name,this.dataList.mealprice=e.flashSalePrice,this.currentmeal=t,this.choosemealdata=e,this.bankCardPrice=e.flashSalePrice-e.bankCardPrice},OnPushshopHome:function(){e.navigateTo({url:"/pages/activityMall/business/index?id="+this.dataList.shopId})},OnPushMap:function(){e.openLocation({latitude:this.dataList.lat,longitude:this.dataList.lng,success:function(){console.log("success")}})},onChange:function(e){this.timeData=e,0==e.days&&0==e.hours&&0==e.minutes&&0==e.seconds&&(this.istimeend=!1)},Oncard:function(t){1==t?e.navigateTo({url:"/pages/carShops/upkeep/insurance?id=0"}):2==t?e.navigateTo({url:"/pages/my/creditCard/detail?type=n"}):3==t?e.navigateTo({url:"/pages/my/creditCard/detail?type=g"}):4==t&&e.navigateTo({url:"/pages/my/creditCard/detail?type=y"}),this.openpop=!1},getswiper:function(){return this.swiperList},getcode:function(t){e.uploadFile({url:getApp().globalData.uploadUrl,filePath:t.data.appletsCode,name:"file",formData:{file:t.data.appletsCode},header:{"Content-Type":"multipart/form-data"},success:function(e){console.log(JSON.parse(e.data).data)}})},getList:function(){var e=this;this.isshowpage||this.$showLoading(),this.$newrequest.get("/coc-active/api/v1/group/getDetails/"+this.id).then((function(t){t.data.groupDetailsMealVOS.filter((function(t){e.surplusStock+=t.stock-t.saleNum})),e.bankCardPrice=t.data.flashSalePrice-t.data.bankCardPrice,e.currentflashSalePrice=t.data.flashSalePrice,e.currentstock=t.data.stock,e.getcode(t),e.option={marketPrice:t.data.marketPrice,flashSalePrice:t.data.bankCardPrice?t.data.bankCardPrice:t.data.flashSalePrice,codeUrl:t.data.qrCode,signUpEndTimeStr:t.data.expirationTime,coverUrl:t.data.coverPicture,headUrl:"https://oss.dcqcjlb.com/51che_java_dev/20221201/ee67baa9692a4ec2a2d1f3141fb3b649.png",bgUrl:"https://oss.dcqcjlb.com/51che_java_dev/20221201/ee67baa9692a4ec2a2d1f3141fb3b649.png",fillStyle:"#0688ff",nickName:"",miniName:"",tkName:t.data.title,tkAuthor:"内容",tkType:"考试",cost:"免费",isPub:"公开"};var i=[];if(t.data.adUrl){var a=t.data.adUrl.split(",");a.forEach((function(e){i.push({url:e,type:"image"})}))}t.data.adPushUrl?(i.unshift({url:t.data.adPushUrl,type:"video",poster:t.data.adCoverImg?t.data.adCoverImg:""}),e.autoPlay=!1):e.autoPlay=!0,e.choosemealdata=t.data.groupDetailsMealVOS[0],e.swiperList=i,e.dataList=t.data,e.dataList.groupPurchaseSetMealId=t.data.groupDetailsMealVOS[0].id,e.dataList.mealname=t.data.groupDetailsMealVOS[0].name,e.dataList.mealprice=t.data.groupDetailsMealVOS[0].flashSalePrice})).catch((function(e){})).finally((function(){e.isshowpage||(e.isshowpage=!0,e.$hideLoading())}))},submitAppoint:function(){var t=this;!0===(0,a.tologin)()&&(1!=this.dataList.isAppointment?this.$newrequest.post("/coc-active/api/v1/group/appointment",{id:this.id}).then((function(i){200==i.code?(t.dataList.isAppointment=1,e.showToast({icon:"none",title:"预约成功"})):e.showToast({icon:"none",title:i.message})})):e.showToast({icon:"none",title:"已预约"}))}}};t.default=n}).call(this,i("543d")["default"])},ce6e:function(e,t,i){"use strict";i.r(t);var a=i("b93a"),n=i("93fe");for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);i("1fab");var s=i("f0c5"),r=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=r.exports}},[["a30c","common/runtime","common/vendor"]]]);