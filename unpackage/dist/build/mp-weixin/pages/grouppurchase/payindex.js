(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/grouppurchase/payindex"],{"67c7":function(e,t,a){"use strict";a.r(t);var n=a("fe11"),o=a("78ce");for(var i in o)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(i);a("a256");var r=a("f0c5"),u=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=u.exports},"78ce":function(e,t,a){"use strict";a.r(t);var n=a("cafe"),o=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t["default"]=o.a},a256:function(e,t,a){"use strict";var n=a("d87b"),o=a.n(n);o.a},af34:function(e,t,a){"use strict";(function(e,t){var n=a("4ea4");a("76b1");n(a("66fd"));var o=n(a("67c7"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(o.default)}).call(this,a("bc2e")["default"],a("543d")["createPage"])},cafe:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a("04ff"),o={components:{},data:function(){return{isnumberbox:!1,rules:{mobile:[{required:!0,message:"请输入手机号",trigger:["change","blur"]},{validator:function(t,a,n){return e.$u.test.mobile(a)},message:"手机号码不正确",trigger:["change","blur"]}],name:{type:"string",required:!0,message:"请填写联系人",trigger:["blur","change"]},plate:{type:"string",required:!0,message:"请输入车牌号",trigger:["blur","change"]}},formdata:{name:"",mobile:"",plate:"",remark:""},forwardUserId:"",groupPurchaseSetMealNum:1,maxnum:999,dataList:{},istype:0,showcarkeyboard:!1,showdetail:!1,orderId:null}},onLoad:function(e){var t=this;if("wx"==e.istype){var a=this.getOpenerEventChannel();a.on("getinfo",(function(e){t.dataList=e.data,t.dataList.allmealprice=t.dataList.mealprice,t.maxnum=e.data.stock-e.data.saleNum}))}"app"==e.from&&(this.istype=1,this.dataList=e,this.dataList.allmealprice=this.dataList.mealprice,this.maxnum=e.stock-e.saleNum),this.forwardUserId=e.forwardUserId,(0,n.getstorage)("token")||(0,n.tologin)(),this.formdata.name=(0,n.getstorage)("nickname"),this.formdata.mobile=(0,n.getstorage)("mobile"),1==e.isnew&&(this.isnumberbox=!0)},onShow:function(){this.formdata.name=(0,n.getstorage)("nickname"),this.formdata.mobile=(0,n.getstorage)("mobile")},onReady:function(){this.$refs.form1.setRules(this.rules)},methods:{wxpay:function(t){var a=this;e.requestPayment({provider:"wxpay",timeStamp:t.miniPayRequest.timeStamp,nonceStr:t.miniPayRequest.nonceStr,package:t.miniPayRequest.package,signType:t.miniPayRequest.signType,paySign:t.miniPayRequest.paySign,appid:t.miniPayRequest.appId,success:function(t){console.log("qian"),e.showToast({icon:"success",title:"支付成功",complete:function(){setTimeout((function(){console.log("后"),e.reLaunch({url:"/pages/grouppurchase/order/detail?id="+a.orderId+"&istype="+a.istype})}),1e3)}})},fail:function(e){a.$request.get("/coc-active/api/v1/group_purchase/failOrder/"+a.orderId).then((function(e){}))}})},userIsCanBuyProduct:function(){var t=this;this.$request.post("/coc-active/api/v1/payment/preference/userIsCanBuyProduct",{activityPaymentPreferenceId:this.dataList.activityPaymentPreferenceId,goodsId:this.dataList.id,type:2,userId:e.getStorageSync("userId")}).then((function(a){200==a.code?1==a.data.isCanBuy?t.OnPay():0==a.data.isCanBuy&&e.$u.toast("您本月已享受该优惠，暂不可购买"):e.$u.toast(a.message)}))},OnPay:function(){var t=this;this.$refs.form1.validate().then((function(a){var n=null;t.orderId&&(n=t.orderId);var o={groupPurchaseProductId:t.dataList.id,groupPurchaseSetMealId:t.dataList.groupPurchaseSetMealId,groupPurchaseSetMealNum:t.groupPurchaseSetMealNum,mobile:t.formdata.mobile,name:t.formdata.name,orderId:n,plate:t.formdata.plate,remark:t.formdata.remark,forwardUserId:t.forwardUserId};t.dataList.userInitiateAssistId&&(o.userInitiateAssistId=t.dataList.userInitiateAssistId),console.log("团购的支付分享人id",t.forwardUserId),o.subOpenId=e.getStorageSync("openid"),t.$request.post("/coc-active/api/v1/group_purchase/groupPayment",o).then((function(e){200==e.code?(t.orderId=e.data.orderId,t.wxpay(e.data.payment)):t.$refs.uToast.show({message:e.message})}))}))},Onclosedetail:function(){this.showdetail=!1},OnOpenDetail:function(){this.showdetail=!this.showdetail},changekeyboard:function(e){if(8==this.formdata.plate.length)return!1;this.formdata.plate=this.formdata.plate+e},Onbackspace:function(){if(0==this.formdata.plate.length)return!1;this.formdata.plate=this.formdata.plate.substr(0,this.formdata.plate.length-1)},OpenCarkeyboard:function(){this.showcarkeyboard=!0},changenum:function(e){this.dataList.allmealprice=this.dataList.mealprice*e.value}}};t.default=o}).call(this,a("543d")["default"])},d87b:function(e,t,a){},fe11:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return n}));var n={uNumberBox:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-number-box/u-number-box")]).then(a.bind(null,"75ba"))},"u-Form":function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u--form/u--form")]).then(a.bind(null,"f093"))},uFormItem:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(a.bind(null,"ee1b"))},"u-Input":function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u--input/u--input")]).then(a.bind(null,"c00c"))},uIcon:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(a.bind(null,"0f14"))},uKeyboard:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-keyboard/u-keyboard")]).then(a.bind(null,"c984"))},uPopup:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(a.bind(null,"8add"))},uToast:function(){return a.e("uni_modules/uview-ui/components/u-toast/u-toast").then(a.bind(null,"1b13"))}},o=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.showcarkeyboard=!1},e.e1=function(t){e.showcarkeyboard=!1},e.e2=function(t){e.showdetail=!1})},i=[]}},[["af34","common/runtime","common/vendor"]]]);