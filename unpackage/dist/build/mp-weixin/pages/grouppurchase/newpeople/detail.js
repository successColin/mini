(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/grouppurchase/newpeople/detail"],{"75b6":function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return i}));var i={uCountDown:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-count-down/u-count-down")]).then(a.bind(null,"e517"))},uParse:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(a.bind(null,"5dcf"))},uPopup:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(a.bind(null,"076f"))},uDivider:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(a.bind(null,"4e62"))},"u-Form":function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u--form/u--form")]).then(a.bind(null,"4b8f"))},uFormItem:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(a.bind(null,"4019"))},"u-Input":function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u--input/u--input")]).then(a.bind(null,"e709"))},uRadioGroup:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-radio-group/u-radio-group")]).then(a.bind(null,"35d2"))},uRadio:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-radio/u-radio")]).then(a.bind(null,"df92"))}},s=function(){var e=this,t=e.$createElement,a=(e._self._c,e.isshowpage&&e.getadUrl?e.getswiper():null),i=e.dataList.bankCardPrice>0&&6==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,s=e.dataList.bankCardPrice>0&&5==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,n=e.dataList.bankCardPrice>0&&7==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,o=e.dataList.bankCardPrice>0&&8==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null,r=e.dataList.bankCardPrice>0&&10==e.dataList.activityPaymentPreferenceId?e.bankCardPrice.toFixed(2):null;e._isMounted||(e.e0=function(t){e.showpop=!1}),e.$mp.data=Object.assign({},{$root:{m0:a,g0:i,g1:s,g2:n,g3:o,g4:r}})},n=[]},"8f41":function(e,t,a){"use strict";(function(e,t){var i=a("4ea4");a("4319");i(a("66fd"));var s=i(a("d9d6"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(s.default)}).call(this,a("bc2e")["default"],a("543d")["createPage"])},"9a83":function(e,t,a){"use strict";a.r(t);var i=a("a777"),s=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t["default"]=s.a},a155b:function(e,t,a){"use strict";var i=a("e862"),s=a.n(i);s.a},a777:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a("7dcd"),s={components:{carousel:function(){Promise.all([a.e("common/vendor"),a.e("components/carousel/index")]).then(function(){return resolve(a("c969"))}.bind(null,a)).catch(a.oe)},Poster:function(){a.e("components/zhangyuhao-poster/Poster").then(function(){return resolve(a("dce9"))}.bind(null,a)).catch(a.oe)}},data:function(){return{poster:"",list:[],token:null,isExpert:null,bankCardPrice:0,surplusStock:0,currentflashSalePrice:0,currentstock:0,radiovalue1:"",rules:{name:{type:"string",required:!0,message:"请填写姓名",trigger:["blur","change"]},mobile:[{required:!0,message:"请输入手机号",trigger:["change","blur"]},{validator:function(t,a,i){return e.$u.test.mobile(a)},message:"手机号码不正确",trigger:["change","blur"]}]},signuodata:{name:"",mobile:""},btntext:"立即抢购",isshowpage:!1,currentmeal:null,showpop:!1,istimeend:!0,safeHeight:0,timeData:{},autoPlay:!1,swiperList:[],dataList:{},openpop:!1,id:"",type:1,choosemeal:{},showpopshare:!1,posterShareUrl:"",option:{},showsignup:!1,forwardUserId:null}},onShareAppMessage:function(t){if(!e.getStorageSync("token"))return(0,i.tologin)(),!1;var a=this.dataList.title,s=this.dataList.appletsSharePic?this.dataList.appletsSharePic:this.dataList.coverPicture;return{title:a,path:"/pages/grouppurchase/newpeople/detail?forwardUserId="+(0,i.getstorage)("userId")+"&id="+this.id,imageUrl:s}},onShareTimeline:function(){if(!e.getStorageSync("token"))return(0,i.tologin)(),!1;var t=this.dataList.title,a=this.dataList.appletsSharePic?this.dataList.appletsSharePic:this.dataList.coverPicture;return{title:t,path:"/pages/grouppurchase/newpeople/detail?forwardUserId="+(0,i.getstorage)("userId")+"&id="+this.id,imageUrl:a}},onLoad:function(t){console.log(t),t.id&&(this.id=t.id),t.forwardUserId&&(this.forwardUserId=t.forwardUserId,e.getStorageSync("token")?e.getStorageSync("token")&&1!=e.getStorageSync("isExpert")&&this.tempparentid():(0,i.tologin)()),t.scene&&(this.id=t.scene.split("_")[0],this.forwardUserId=t.scene.split("_")[1],e.getStorageSync("token")?e.getStorageSync("token")&&1!=e.getStorageSync("isExpert")&&this.tempparentid():(0,i.tologin)()),this.token=e.getStorageSync("token"),this.isExpert=e.getStorageSync("isExpert"),this.getList()},onShow:function(){this.getList(),this.signuodata.mobile=(0,i.getstorage)("mobile"),this.forwardUserId&&e.getStorageSync("token")&&this.tempparentid()},computed:{height:function(){return"calc(100vh - 42px - 48rpx - ".concat(this.safeHeight,"px)")},getadUrl:function(){return!!this.dataList.adUrl}},onReady:function(){var t=this;this.$refs.uForm.setRules(this.rules),e.createSelectorQuery().in(this).select(".safe-bottom-height").boundingClientRect((function(e){t.safeHeight=e.height})).exec()},methods:{tempparentid:function(){this.$request.post("/coc-active/api/v1/invite/temp_parent_id/add",{tempParentId:this.forwardUserId}).then((function(e){}))},Oncopy:function(t){e.setClipboardData({data:t,success:function(){e.$u.toast("复制成功")}})},posterSuccess:function(e){this.poster=e},OnSaveImage:function(){var t=[this.poster];e.previewImage({current:99999,urls:t,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}})},addClue:function(){var t=this;if(!this.radiovalue1)return e.$u.toast("请同意并阅读个人信息保护声明"),!1;this.$refs.uForm.validate().then((function(a){t.$newrequest.post("/coc-active/api/v1/sign_up/not/designated/user/addClue",{correlationId:t.id,mobile:t.signuodata.mobile,name:t.signuodata.name,type:"2"}).then((function(a){200==a.code?(e.$u.toast("预约成功"),t.showsignup=!1):e.$u.toast(a.message)}))}))},OnPushPrivacyPolicy:function(){e.navigateTo({url:"/pages/agreement/webview?url=https://h5.dcqcjlb.com/protocol/user_vehicle_consultation.html"})},closesignup:function(){this.showsignup=!1},Onaddcollections:function(){(0,i.tologin)(),2==this.dataList.isCollection?this.dataList.isCollection=1:this.dataList.isCollection=2,(0,i.getstorage)("token")&&this.$request.post("/coc-active/api/v1/collections/add_collections",{type:"3",relId:this.dataList.id,relName:this.dataList.shopName,activityMoney:this.dataList.flashSalePrice}).then((function(e){if(200==e.code);}))},OnCloseShare:function(){this.showpopshare=!1},popposter:function(){var t=this;if(!e.getStorageSync("token"))return(0,i.tologin)(),!1;this.$request.post("/coc-active/api/v1/invite/getMiniProgramQrCode",{page:"pages/grouppurchase/newpeople/detail",scene:this.id+"_"+e.getStorageSync("userId")}).then((function(e){t.showpopshare=!0,t.list=[{type:"image",path:t.dataList.posterFigureUrl,x:0,y:0,width:443,height:787},{type:"image",path:e.data.qrCode,x:18,y:682,width:90,height:90}],t.$nextTick((function(){t.$refs.poster.create()}))}))},Onopen:function(){var t=this;!0===(0,i.tologin)()&&(1==this.dataList.isDesignated?this.$newrequest.post("/coc-active/api/v1/sign_up/designated/user/canBuy",{activityId:this.id,type:"2"}).then((function(a){200==a.code?0==a.data?t.showsignup=!0:t.showpop=!0:e.showToast({icon:"none",title:a.message})})):this.showpop=!0)},Onsingup:function(){var t=this,a=this;if(null==this.currentmeal&&0!=this.currentmeal)return e.showToast({icon:"none",title:"请选择一个套餐~"}),!1;if(this.choosemeal.stock-this.choosemeal.saleNum<=0)return e.showToast({icon:"none",title:"库存已抢光~"}),!1;if(console.log("普通团购",this.choosemeal.helpNum),console.log(this.choosemeal.newUserLimit),0==this.choosemeal.helpNum&&2==this.choosemeal.newUserLimit)e.navigateTo({url:"/pages/grouppurchase/payindex?istype=wx",success:function(e){e.eventChannel.emit("getinfo",{data:a.dataList})}});else if(0==this.choosemeal.helpNum&&1==this.choosemeal.newUserLimit)this.$request.post("/coc-active/api/v1/group/isNewPerson",{type:1}).then((function(t){1==t.data.type?e.navigateTo({url:"/pages/grouppurchase/payindex?istype=wx",success:function(e){e.eventChannel.emit("getinfo",{data:a.dataList})}}):e.showToast({icon:"none",title:"此套餐仅限新用户购买"})}));else if(this.choosemeal.helpNum>0){if(console.log("需要助力，大于0"),1==this.choosemeal.newUserLimit)return this.$request.post("/coc-active/api/v1/group/isNewPerson",{type:1}).then((function(i){console.log(i.data.type),1==i.data.type?2==t.choosemeal.assistType?(e.requestSubscribeMessage({tmplIds:["Y6oHOz_GfrbHRkznU_LyI-y10mAjzGJeUdqnTiSY4ms"],success:function(e){}}),t.$request.post("/coc-active/api/v1/group/initiateAssist",{mealId:t.choosemeal.id}).then((function(i){200==i.code?(t.choosemeal.assistType=1,t.choosemeal.userInitiateAssistId=i.data.userInitiateAssistId,t.dataList.groupDetailsMealVOS[t.currentmeal].assistType=1,t.dataList.groupDetailsMealVOS[t.currentmeal].userInitiateAssistId=i.data.userInitiateAssistId,e.navigateTo({url:"/pages/grouppurchase/newpeople/assistance?userInitiateAssistId="+i.data.userInitiateAssistId,success:function(e){e.eventChannel.emit("getinfo",{data:a.dataList})}})):(console.log("返回不是200 或 已经助力过",i.message),t.$refs.uToast.show({message:i.message}))}))):1==t.choosemeal.assistType&&e.navigateTo({url:"/pages/grouppurchase/newpeople/assistance?userInitiateAssistId="+t.choosemeal.userInitiateAssistId,success:function(e){e.eventChannel.emit("getinfo",{data:a.dataList})}}):e.showToast({icon:"none",title:"此套餐仅限新用户购买"})})),!1;2==this.choosemeal.assistType?(e.requestSubscribeMessage({tmplIds:["Y6oHOz_GfrbHRkznU_LyI-y10mAjzGJeUdqnTiSY4ms"],success:function(e){}}),this.$request.post("/coc-active/api/v1/group/initiateAssist",{mealId:this.choosemeal.id}).then((function(i){200==i.code?(t.choosemeal.assistType=1,t.choosemeal.userInitiateAssistId=i.data.userInitiateAssistId,t.dataList.groupDetailsMealVOS[t.currentmeal].assistType=1,t.dataList.groupDetailsMealVOS[t.currentmeal].userInitiateAssistId=i.data.userInitiateAssistId,e.navigateTo({url:"/pages/grouppurchase/newpeople/assistance?userInitiateAssistId="+i.data.userInitiateAssistId,success:function(e){e.eventChannel.emit("getinfo",{data:a.dataList})}})):(console.log("返回不是200 或 已经助力过",i.message),t.$refs.uToast.show({message:i.message}))}))):1==this.choosemeal.assistType&&e.navigateTo({url:"/pages/grouppurchase/newpeople/assistance?userInitiateAssistId="+this.choosemeal.userInitiateAssistId,success:function(e){e.eventChannel.emit("getinfo",{data:a.dataList})}})}},Onchoosemeal:function(e,t){0==e.helpNum?this.btntext="立即抢购":1==e.assistType?this.btntext="查看助力进度":2==e.assistType&&(this.btntext="发起助力"),this.currentflashSalePrice=e.flashSalePrice,this.currentstock=e.stock-e.saleNum,this.choosemeal=e,this.dataList.groupPurchaseSetMealId=e.id,this.dataList.mealname=e.name,this.dataList.mealprice=e.flashSalePrice,this.currentmeal=t,this.bankCardPrice=e.flashSalePrice-e.bankCardPrice},OnPushshopHome:function(){e.navigateTo({url:"/pages/activityMall/business/index?id="+this.dataList.shopId})},OnPushMap:function(){e.openLocation({latitude:this.dataList.lat,longitude:this.dataList.lng,success:function(){console.log("success")}})},onChange:function(e){this.timeData=e,0==e.days&&0==e.hours&&0==e.minutes&&0==e.seconds&&(this.istimeend=!1)},Oncard:function(t){1==t?e.navigateTo({url:"/pages/carShops/upkeep/insurance?id=0"}):2==t?e.navigateTo({url:"/pages/my/creditCard/detail?type=n"}):3==t?e.navigateTo({url:"/pages/my/creditCard/detail?type=g"}):4==t&&e.navigateTo({url:"/pages/my/creditCard/detail?type=y"}),this.openpop=!1},getswiper:function(){return this.swiperList},getcode:function(t){e.uploadFile({url:getApp().globalData.uploadUrl,filePath:t.data.appletsCode,name:"file",formData:{file:t.data.appletsCode},header:{"Content-Type":"multipart/form-data"},success:function(e){console.log(JSON.parse(e.data).data)}})},getList:function(){var e=this;this.isshowpage||this.$showLoading(),this.$newrequest.get("/coc-active/api/v1/group/getDetails/"+this.id).then((function(t){t.data.groupDetailsMealVOS.filter((function(t){e.surplusStock+=t.stock-t.saleNum})),e.getcode(t),e.bankCardPrice=t.data.flashSalePrice-t.data.bankCardPrice,e.currentflashSalePrice=t.data.flashSalePrice,e.currentstock=t.data.stock,e.option={marketPrice:t.data.marketPrice,flashSalePrice:t.data.bankCardPrice?t.data.bankCardPrice:t.data.flashSalePrice,codeUrl:t.data.newQrCode,signUpEndTimeStr:t.data.expirationTime,coverUrl:t.data.coverPicture,headUrl:"https://oss.dcqcjlb.com/51che_java_dev/20221201/ee67baa9692a4ec2a2d1f3141fb3b649.png",bgUrl:"https://oss.dcqcjlb.com/51che_java_dev/20221201/ee67baa9692a4ec2a2d1f3141fb3b649.png",fillStyle:"#0688ff",nickName:"",miniName:"",tkName:t.data.title,tkAuthor:"内容",tkType:"考试",cost:"免费",isPub:"公开"};var a=[];if(t.data.adUrl){var i=t.data.adUrl.split(",");i.forEach((function(e){a.push({url:e,type:"image"})}))}t.data.adPushUrl?(a.unshift({url:t.data.adPushUrl,type:"video",poster:t.data.adCoverImg?t.data.adCoverImg:""}),e.autoPlay=!1):e.autoPlay=!0,0==t.data.groupDetailsMealVOS[0].helpNum?e.btntext="立即抢购":1==t.data.groupDetailsMealVOS[0].assistType?e.btntext="查看助力进度":2==t.data.groupDetailsMealVOS[0].assistType&&(e.btntext="发起助力"),e.choosemeal=t.data.groupDetailsMealVOS[0],e.swiperList=a,e.dataList=t.data,e.dataList.groupPurchaseSetMealId=t.data.groupDetailsMealVOS[0].id,e.dataList.mealname=t.data.groupDetailsMealVOS[0].name,e.dataList.mealprice=t.data.groupDetailsMealVOS[0].flashSalePrice})).catch((function(e){})).finally((function(){e.isshowpage||(e.isshowpage=!0,e.$hideLoading())}))}}};t.default=s}).call(this,a("543d")["default"])},d9d6:function(e,t,a){"use strict";a.r(t);var i=a("75b6"),s=a("9a83");for(var n in s)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(n);a("a155b");var o=a("f0c5"),r=Object(o["a"])(s["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=r.exports},e862:function(e,t,a){}},[["8f41","common/runtime","common/vendor"]]]);