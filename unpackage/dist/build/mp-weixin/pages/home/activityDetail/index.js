(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/activityDetail/index"],{"3b34":function(t,e,i){},5905:function(t,e,i){"use strict";var a=i("3b34"),n=i.n(a);n.a},"5df0":function(t,e,i){"use strict";i.r(e);var a=i("6b1a"),n=i("6958");for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);i("5905");var o=i("f0c5"),r=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,"56eb7263",null,!1,a["a"],void 0);e["default"]=r.exports},6958:function(t,e,i){"use strict";i.r(e);var a=i("bee8"),n=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e["default"]=n.a},"6b1a":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return a}));var a={uNavbar:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-navbar/u-navbar")]).then(i.bind(null,"45e8"))},uIcon:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(i.bind(null,"f23e"))},uAvatar:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-avatar/u-avatar")]).then(i.bind(null,"6d2c"))},uParse:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(i.bind(null,"5dcf"))},"u-Image":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--image/u--image")]).then(i.bind(null,"4497"))},uPopup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(i.bind(null,"076f"))},uDivider:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(i.bind(null,"4e62"))},uToast:function(){return i.e("uni_modules/uview-ui/components/u-toast/u-toast").then(i.bind(null,"4bf8"))},uLoadingPage:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-loading-page/u-loading-page")]).then(i.bind(null,"fbb6"))},"u-Form":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--form/u--form")]).then(i.bind(null,"4b8f"))},uFormItem:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(i.bind(null,"4019"))},"u-Input":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--input/u--input")]).then(i.bind(null,"e709"))},uRadioGroup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio-group/u-radio-group")]).then(i.bind(null,"35d2"))},uRadio:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-radio/u-radio")]).then(i.bind(null,"df92"))}},n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.isshowpage&&t.dataList.activity.adUrl?t.getswiper():null),a=t.isshowpage?t.getshopName():null,n=t.isshowpage&&t.dataList.activity.bankCardPrice>0&&6==t.dataList.activity.activityPaymentPreferenceId?t.bankCardPrice.toFixed(2):null,s=t.isshowpage&&t.dataList.activity.bankCardPrice>0&&5==t.dataList.activity.activityPaymentPreferenceId?t.bankCardPrice.toFixed(2):null,o=t.isshowpage&&t.dataList.activity.bankCardPrice>0&&7==t.dataList.activity.activityPaymentPreferenceId?t.bankCardPrice.toFixed(2):null,r=t.isshowpage&&t.dataList.activity.bankCardPrice>0&&8==t.dataList.activity.activityPaymentPreferenceId?t.bankCardPrice.toFixed(2):null;t._isMounted||(t.e0=function(e){t.openpop=!1},t.e1=function(e){t.openpop=!1}),t.$mp.data=Object.assign({},{$root:{m0:i,m1:a,g0:n,g1:s,g2:o,g3:r}})},s=[]},ac53:function(t,e,i){"use strict";(function(t,e){var a=i("4ea4");i("4319");a(i("66fd"));var n=a(i("5df0"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},bee8:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i("7dcd"),n={components:{carousel:function(){Promise.all([i.e("common/vendor"),i.e("components/carousel/index")]).then(function(){return resolve(i("c969"))}.bind(null,i)).catch(i.oe)},Poster:function(){i.e("components/zhangyuhao-poster/Poster").then(function(){return resolve(i("dce9"))}.bind(null,i)).catch(i.oe)},commission:function(){i.e("components/commission/index").then(function(){return resolve(i("c47e"))}.bind(null,i)).catch(i.oe)},joinshopbtn:function(){i.e("components/joinshopbtn/index").then(function(){return resolve(i("28c1"))}.bind(null,i)).catch(i.oe)}},data:function(){return{poster:"",list:[],token:null,isExpert:null,surplusStock:0,showsignup:!1,radiovalue1:"",rules:{name:{type:"string",required:!0,message:"请填写姓名",trigger:["blur","change"]},mobile:[{required:!0,message:"请输入手机号",trigger:["change","blur"]},{validator:function(e,i,a){return t.$u.test.mobile(i)},message:"手机号码不正确",trigger:["change","blur"]}]},signuodata:{name:"",mobile:""},currentmealitem:{},openpop:!1,autoPlay:!1,showloading:!1,safeHeight:0,setMealId:"",stock:"",limitNum:"1",currentsession:null,showpopshare:!1,activitySetMealNum:1,evaluates:[],choosevote:"",today:"",forwardUserId:null,showsingnup:!1,imgs:[],mygroup:[],columns:[],showinteractive:!1,client:!0,dataList:{},count:4,value:1,id:"",name:"",choseshare:{},userId:"",isLoadMore:!1,current:1,posterShareUrl:"",Meal:[],MealIndex:999,currentMeal:{},attendId:"",day:"",Events:"",flashSalePrice:"",isapp:0,marketPrice:"",swiperList:[],appointSuccessVisble:!1,appointVisble:!1,appointList:[{id:1,name:"周末",ischecked:!1},{id:2,name:"节假日",ischecked:!1},{id:3,name:"晚上",ischecked:!1},{id:4,name:"都可以",ischecked:!1}],iscommission:0,isshowpage:!1,showtop:!1,bankCardPrice:0}},onShareAppMessage:function(t){(0,a.tologin)(),this.$request.post("/coc-active/api/v1/marvellous_activity/share_v2",{relId:this.dataList.activity.id,shareType:"1",type:"1"}).then((function(t){}));var e=this.dataList.activity.title,i=this.dataList.activity.appletsSharePic?this.dataList.activity.appletsSharePic:this.dataList.activity.coverPicture;return{title:e,path:"/pages/home/activityDetail/index?forwardUserId="+this.forwardUserId+"&id="+this.id,imageUrl:i}},onShareTimeline:function(){(0,a.tologin)(),this.$request.post("/coc-active/api/v1/marvellous_activity/share_v2",{relId:this.dataList.activity.id,shareType:"2",type:"1"}).then((function(t){}));var t=this.dataList.activity.title,e=this.dataList.activity.appletsSharePic?this.dataList.activity.appletsSharePic:this.dataList.activity.coverPicture;return{title:t,path:"/pages/home/activityDetail/index?forwardUserId="+this.forwardUserId+"&id="+this.id,imageUrl:e}},computed:{height:function(){return"calc(100vh - 42px - 48rpx - ".concat(this.safeHeight,"px)")}},onUnload:function(){1==this.isapp&&(window._51club&&window._51club.backIntercept("app"),window.webkit.messageHandlers&&window.webkit.messageHandlers.backIntercept.postMessage("app"))},onPageScroll:function(e){var i=this;t.getSystemInfo({success:function(t){e.scrollTop>300?i.showtop=!0:i.showtop=!1}})},onLoad:function(e){e.iscommission&&(this.iscommission=e.iscommission),e.id&&(this.id=e.id),e.isapp&&(this.isapp=1),e.forwardUserId&&(this.forwardUserId=e.forwardUserId,t.getStorageSync("token")?t.getStorageSync("token")&&1!=t.getStorageSync("isExpert")&&this.tempparentid():(0,a.tologin)()),e.scene&&(this.id=e.scene.split("_")[0],this.forwardUserId=e.scene.split("_")[1],t.getStorageSync("token")?t.getStorageSync("token")&&1!=t.getStorageSync("isExpert")&&this.tempparentid():(0,a.tologin)());var i=this;this.today=(new Date).valueOf(),"ios"==t.getSystemInfoSync().platform?this.client=!1:this.client=!0,this.token=t.getStorageSync("token"),this.isExpert=t.getStorageSync("isExpert"),this.forwardUserId||(this.forwardUserId=(0,a.getstorage)("userId")),t.$on("saveaddshop",(function(t){i.getList()})),this.getList()},onReachBottom:function(){this.isLoadMore||(this.current++,this.getList())},onShow:function(){this.signuodata.mobile=(0,a.getstorage)("mobile"),this.forwardUserId&&t.getStorageSync("token")&&this.tempparentid()},onReady:function(){var e=this;this.$refs.uForm.setRules(this.rules),t.createSelectorQuery().in(this).select(".safe-bottom-height").boundingClientRect((function(t){e.safeHeight=t.height})).exec()},methods:{onreturn:function(){1==this.isapp&&(window._51club&&window._51club.backIntercept("app"),window.webkit.messageHandlers&&window.webkit.messageHandlers.backIntercept.postMessage("app"))},tempparentid:function(){this.$request.post("/coc-active/api/v1/invite/temp_parent_id/add",{tempParentId:this.forwardUserId}).then((function(t){}))},Oncopy:function(e){t.setClipboardData({data:e,success:function(){t.$u.toast("复制成功")}})},posterSuccess:function(t){this.poster=t},addClue:function(){var e=this;if(!this.radiovalue1)return t.$u.toast("请同意并阅读个人信息保护声明"),!1;this.$refs.uForm.validate().then((function(i){e.$newrequest.post("/coc-active/api/v1/sign_up/not/designated/user/addClue",{correlationId:e.id,mobile:e.signuodata.mobile,name:e.signuodata.name,type:"1"}).then((function(i){200==i.code?(t.$u.toast("预约成功"),e.showsignup=!1):t.$u.toast(i.message)}))}))},OnPushPrivacyPolicy:function(){t.navigateTo({url:"/pages/agreement/webview?url=https://h5.dcqcjlb.com/protocol/user_vehicle_consultation.html"})},closesignup:function(){this.showsignup=!1},creditcard:function(e){t.navigateTo({url:"/pages/my/card/index"}),this.openpop=!1},Oncard:function(e){1==e?t.navigateTo({url:"/pages/carShops/upkeep/insurance?id=0"}):2==e?t.navigateTo({url:"/pages/my/creditCard/detail?type=n"}):3==e?t.navigateTo({url:"/pages/my/creditCard/detail?type=g"}):4==e&&t.navigateTo({url:"/pages/my/creditCard/detail?type=y"}),this.openpop=!1},OnPushSHome:function(){2==this.dataList.activity.shopTypeId?t.navigateTo({url:"/pages/carShops/4Sdetail/index?id="+this.dataList.shopVO.shopId}):3==this.dataList.activity.shopTypeId&&t.navigateTo({url:"/pages/activityMall/business/index?id="+this.dataList.shopVO.shopId})},Onremind:function(){if((0,a.getstorage)("token")||t.navigateTo({url:"/pages/activity/share/index?activityId="+this.id}),1==this.dataList.isRemind)return!1;var e=this;t.requestSubscribeMessage({tmplIds:["DS1aWHTQ1gSPOeuh2-eng-mUZMX0xc_OMhFeJMESElY"],success:function(i){"accept"==i["DS1aWHTQ1gSPOeuh2-eng-mUZMX0xc_OMhFeJMESElY"]&&((0,a.setstorage)("setRegistrationreminder","1"),e.$request.get("/coc-active/api/v1/activity/signUpStartRemind/"+e.dataList.activity.id).then((function(i){200==i.code?(t.showToast({icon:"none",title:"提醒成功，请等待通知"}),e.dataList.isRemind=1):t.showToast({icon:"none",title:i.message})})))}})},ClickZhiDing:function(){t.pageScrollTo({scrollTop:0,duration:300})},getshopName:function(){if(this.dataList.shopVO.shopName)return this.dataList.shopVO.shopName},jumpWonderfulReview:function(){t.navigateTo({url:"/pages/home/wonderfulReview/detail?id="+this.dataList.activityMarvellousId})},OnSaveImage:function(){var e=[this.poster];t.previewImage({current:99999,urls:e,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(t){console.log("选中了第"+(t.tapIndex+1)+"个按钮,第"+(t.index+1)+"张图片")},fail:function(t){console.log(t.errMsg)}}})},OnSession:function(t,e){if(0==t.isCanSignUp)return!1;this.day=t.days,this.Events=t.beginTime+" - "+t.endTime,this.attendId=t.id,this.currentsession=e},OnClosesingnup:function(){this.showsingnup=!1},OnCloseShare:function(){this.showpopshare=!1},popposter:function(){var e=this;if(!t.getStorageSync("token"))return(0,a.tologin)(),!1;t.requestSubscribeMessage({tmplIds:["b4r77TQXXqIxfxxMx81L7Lp3pOhPKlAb7eVpp6mi7bY"],success:function(t){}}),this.$request.post("/coc-active/api/v1/invite/getMiniProgramQrCode",{page:"pages/home/activityDetail/index",scene:this.id+"_"+this.forwardUserId}).then((function(t){e.showpopshare=!0,e.list=[{type:"image",path:e.dataList.activity.posterFigureUrl,x:0,y:0,width:443,height:787},{type:"image",path:t.data.qrCode,x:18,y:682,width:90,height:90}],e.$nextTick((function(){e.$refs.poster.create()}))}))},OnChooseMeal:function(t,e){this.currentmealitem=t,this.limitNum=t.limitNum,this.setMealId=t.id,this.stock=t.surplusStock,this.MealIndex=e,this.marketPrice=t.marketPrice,this.flashSalePrice=t.flashSalePrice,this.activitySetMealNum=1,this.bankCardPrice=t.flashSalePrice-t.bankCardPrice},OnAddMeal:function(){if(!this.setMealId)return this.$refs.uToastpop.show({message:"请选择套餐"}),!1;var t=this.Meal.activitySetMeals[this.MealIndex].surplusStock,e=this.Meal.activitySetMeals[this.MealIndex].limitNum;if(this.activitySetMealNum==t)this.$refs.uToastpop.show({message:"选购数量无法超过库存"});else{if(this.activitySetMealNum==e)return!1;this.activitySetMealNum++}},OnDelete:function(){return this.setMealId?1!=this.activitySetMealNum&&void this.activitySetMealNum--:(this.$refs.uToastpop.show({message:"请选择套餐"}),!1)},OnChoosevote:function(t,e){var i=this;this.$request.post("/coc-social/api/v1/article/vote",{votesId:t.votesId,votesOptionsId:t.id}).then((function(t){200==t.code?(i.choosevote=e,i.getList()):i.$refs.uToast.show({message:t.message})}))},appointInit:function(){this.appointList=[{id:1,name:"周末",ischecked:!1},{id:2,name:"节假日",ischecked:!1},{id:3,name:"晚上",ischecked:!1},{id:4,name:"都可以",ischecked:!1}]},openAppoint:function(){(0,a.getstorage)("token")||t.navigateTo({url:"/pages/activity/share/index?activityId="+this.id}),this.appointInit(),this.appointVisble=!0},closeAppoint:function(){this.appointVisble=!1},clickAppoint:function(t){this.appointList[t].ischecked=!this.appointList[t].ischecked},submitAppoint:function(){var e=this;if(!0===(0,a.tologin)()){var i=[];this.appointList.map((function(t){t.ischecked&&i.push(t.id)})),0!==i.length?this.$newrequest.post("/coc-active/api/v1/marvellous_activity/appointment",{activityId:this.id,time:i}).then((function(i){200==i.code?(e.appointVisble=!1,e.appointSuccessVisble=!0):t.showToast({title:i.message,icon:"none",duration:2e3})})):t.showToast({title:"请选择预约时间",icon:"none",duration:2e3})}},closeAppointSuccess:function(){this.appointSuccessVisble=!1},OnPushDetail:function(e){t.navigateTo({url:"/pages/home/activityDetail/index?id="+e.id})},Onaddcollections:function(){(0,a.tologin)(),2==this.dataList.activity.isCollection?this.dataList.activity.isCollection=1:this.dataList.activity.isCollection=2,(0,a.getstorage)("token")&&this.$request.post("/coc-active/api/v1/collections/add_collections",{type:"1",relId:this.dataList.activity.id,relName:this.dataList.shopVO.shopName,activityMoney:this.dataList.activity.flashSalePrice}).then((function(t){if(200==t.code);}))},Onsingup:function(){var e=this;return this.setMealId?this.attendId?void(1==this.currentmealitem.newUserLimit?this.$request.post("/coc-active/api/v1/group/isNewPerson",{type:1}).then((function(i){1==i.data.type?e.topay():t.showToast({icon:"none",title:"此套餐仅限新用户购买"})})):this.topay()):(this.$refs.uToastpop.show({message:"请选择场次"}),!1):(this.$refs.uToastpop.show({message:"请选择套餐"}),!1)},topay:function(){var e=this;this.$request.get("/coc-active/api/v1/activity/getActivitySetMeal/"+this.id).then((function(i){if(i.data.activitySetMeals[e.MealIndex].surplusStock<e.activitySetMealNum)return e.showsingnup=!1,e.$refs.uToast.show({message:"库存已抢光~"}),e.MealIndex="999",e.limitNum="1",e.setMealId="",e.stock="",e.marketPrice="",e.flashSalePrice="",e.activitySetMealNum=1,e.day="",e.Events="",e.attendId="",e.currentsession=null,!1;e.currentMeal=e.Meal.activitySetMeals[e.MealIndex];var a=e.currentMeal.adultNum*e.activitySetMealNum,n=e.currentMeal.childrenNum*e.activitySetMealNum;e.showsingnup=!1,t.navigateTo({url:"/pages/service/payMent/detail?activityId="+e.id+"&setMealId="+e.setMealId+"&MealName="+e.currentMeal.name+"&setMealNum="+e.activitySetMealNum+"&attendId="+e.attendId+"&personnum="+a+"&childnum="+n+"&flashSalePrice="+e.currentMeal.flashSalePrice+"&title="+e.Meal.title+"&day="+e.day+"&Events="+e.Events+"&activityPaymentPreferenceId="+e.dataList.activity.activityPaymentPreferenceId+"&forwardUserId="+e.forwardUserId})}))},next:function(){var e=this;if(t.requestSubscribeMessage({tmplIds:["DS1aWHTQ1gSPOeuh2-eng-mUZMX0xc_OMhFeJMESElY","JeuwJCr-FQboBcI6RFJl6GmVxPNWbtU31_B_Ti3jj0w","b4r77TQXXqIxfxxMx81L7Lp3pOhPKlAb7eVpp6mi7bY"],success:function(t){}}),(0,a.getstorage)("token")){if(2==e.dataList.activity.status)return e.$refs.uToast.show({message:"已下架的活动无法报名"}),!1;e.MealIndex="999",e.limitNum="1",e.setMealId="",e.stock="",e.marketPrice="",e.flashSalePrice="",e.activitySetMealNum=1,e.day="",e.Events="",e.attendId="",e.currentsession=null,e.$request.get("/coc-active/api/v1/activity/getActivitySetMeal/"+e.id).then((function(t){e.stock=t.data.stock,e.limitNum=t.data.limitNum,e.Meal=t.data,e.marketPrice=t.data.marketPrice,e.flashSalePrice=t.data.flashSalePrice})),e.showsingnup=!0}},Onsignup:function(){var e=this;if((0,a.getstorage)("token")||t.navigateTo({url:"/pages/activity/share/index?activityId="+this.id}),0==this.surplusStock)return!1;1==this.dataList.activity.isDesignated?this.$newrequest.post("/coc-active/api/v1/sign_up/designated/user/canBuy",{activityId:this.id,type:"1"}).then((function(i){200==i.code?0==i.data?e.showsignup=!0:e.next():t.showToast({icon:"none",title:i.message})})):this.next()},getdate:function(t){var e=t.substring(5,10)+" "+t.substring(11,16);return e},Ontel:function(){t.makePhoneCall({phoneNumber:this.dataList.activity.tel})},OnchooseLocation:function(e){var i="",a="";2==e?(i=this.dataList.activity.lat,a=this.dataList.activity.lng):(i=this.dataList.shopVO.lat,a=this.dataList.shopVO.lng),t.openLocation({latitude:i,longitude:a,success:function(){console.log("success")}})},getswiper:function(){return this.swiperList},getcode:function(e){t.uploadFile({url:getApp().globalData.uploadUrl,filePath:e.data.appletsCode,name:"file",formData:{file:e.data.appletsCode},header:{"Content-Type":"multipart/form-data"},success:function(t){console.log(JSON.parse(t.data).data)}})},getList:function(){var t=this;this.isshowpage||this.$showLoading();this.$newrequest.post("/coc-active/api/v1/activity/detail",{activityId:this.id,forwardUserId:this.forwardUserId,current:this.current,size:10}).then((function(e){t.bankCardPrice=e.data.activity.flashSalePrice-e.data.activity.bankCardPrice,t.getcode(e),e.data.setMealVO.filter((function(e){t.surplusStock+=e.surplusStock}));var i=[];if(e.data.activity.adUrl){var n=e.data.activity.adUrl.split(",");n.forEach((function(t){i.push({url:t,type:"image"})}))}e.data.activity.adPushUrl?(i.unshift({url:e.data.activity.adPushUrl,type:"video",poster:e.data.activity.adCoverImg?e.data.activity.adCoverImg:e.data.activity.adPushUrl+"?x-oss-process=video/snapshot,t_1000,m_fast"}),t.autoPlay=!1):t.autoPlay=!0,t.swiperList=i,t.dataList=e.data,t.dataList.activity.imgs&&(t.imgs=t.dataList.activity.imgs.split(",")),1==t.current?t.evaluates=e.data.evaluates:e.data.evaluates.filter((function(e){t.evaluates.push(e)})),4==e.data.activity.activityPaymentPreferenceId?!(0,a.getstorage)("poptype4")||(new Date).getTime()-(0,a.getstorage)("poptype4")>2592e6?(t.openpop=!0,(0,a.setstorage)("poptype4",(new Date).getTime())):t.openpop=!1:5==e.data.activity.activityPaymentPreferenceId?!(0,a.getstorage)("poptype5")||(new Date).getTime()-(0,a.getstorage)("poptype5")>2592e6?(t.openpop=!0,(0,a.setstorage)("poptype5",(new Date).getTime())):t.openpop=!1:6==e.data.activity.activityPaymentPreferenceId?!(0,a.getstorage)("poptype6")||(new Date).getTime()-(0,a.getstorage)("poptype6")>2592e6?(t.openpop=!0,(0,a.setstorage)("poptype6",(new Date).getTime())):t.openpop=!1:7==e.data.activity.activityPaymentPreferenceId&&(!(0,a.getstorage)("poptype7")||(new Date).getTime()-(0,a.getstorage)("poptype7")>2592e6?(t.openpop=!0,(0,a.setstorage)("poptype7",(new Date).getTime())):t.openpop=!1)})).catch((function(t){})).finally((function(){t.isshowpage||(t.isshowpage=!0,t.$hideLoading())}))}}};e.default=n}).call(this,i("543d")["default"])}},[["ac53","common/runtime","common/vendor"]]]);