(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/myorder/couponcode"],{"0221":function(e,t,o){"use strict";o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return n}));var n={uDivider:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(o.bind(null,"944a"))},uIcon:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(o.bind(null,"0f14"))},uAvatar:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-avatar/u-avatar")]).then(o.bind(null,"d838"))},uRate:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-rate/u-rate")]).then(o.bind(null,"439d"))},uLoadingPage:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-loading-page/u-loading-page")]).then(o.bind(null,"e325"))},uToast:function(){return o.e("uni_modules/uview-ui/components/u-toast/u-toast").then(o.bind(null,"1b13"))}},i=function(){var e=this,t=e.$createElement,o=(e._self._c,e.isshowpage?e.orderdetail.activitySignUpInsurances&&e.orderdetail.activitySignUpInsurances.length>0:null),n=!e.isshowpage||0!=e.orderdetail.status&&7!=e.orderdetail.status?null:e.couponList.length,i=!e.isshowpage||0!=e.orderdetail.status&&7!=e.orderdetail.status||0==n?null:e.choosecoupon.length,a=e.isshowpage&&0!==e.orderdetail.paidMoney?e.orderdetail.paidMoney.toFixed(2):null;e.$mp.data=Object.assign({},{$root:{g0:o,g1:n,g2:i,g3:a}})},a=[]},"04c9":function(e,t,o){"use strict";o.r(t);var n=o("0221"),i=o("50a3");for(var a in i)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return i[e]}))}(a);o("ce4b");var s=o("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=u.exports},"50a3":function(e,t,o){"use strict";o.r(t);var n=o("e86e"),i=o.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a},ad48:function(e,t,o){},b39f:function(e,t,o){"use strict";(function(e,t){var n=o("4ea4");o("76b1");n(o("66fd"));var i=n(o("04c9"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(i.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},ce4b:function(e,t,o){"use strict";var n=o("ad48"),i=o.n(n);i.a},e86e:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o("04ff"),i={components:{},data:function(){return{orderdetail:{},orderNo:"",userId:"",joinpeople:"",couponList:[],choosecoupon:[],allprice:"",isshowpage:!1}},onLoad:function(t){var o=this;this.userId=(0,n.getstorage)("userId"),this.orderNo=t.id,e.$on("choosecoupon",(function(e){o.choosecoupon=e.data,o.orderdetail.paidMoney=o.allprice,o.choosecoupon.filter((function(e){o.orderdetail.paidMoney=o.orderdetail.paidMoney-e.discountMoney})),o.orderdetail.paidMoney<=0&&(o.orderdetail.paidMoney=.01)})),this.getcode()},onShow:function(){},methods:{OnGoHome:function(){e.switchTab({url:"/pages/home/index"})},OnPushcoupon:function(){if(1==this.orderdetail.status||2==this.orderdetail.status||3==this.orderdetail.status)return!1;var t=this;e.navigateTo({url:"/pages/service/couponList/index",success:function(e){e.eventChannel.emit("couponList",{data:{couponList:t.couponList,choosecoupon:t.choosecoupon}})}})},OnPay:function(){var e=this,t=!1;t=this.orderdetail.activitySignUpInsurances?1:0;var o=[];this.choosecoupon.filter((function(e){o.push({discountMoney:e.discountMoney,couponNewId:e.couponNewId,couponUserNewId:e.couponUserNewId})})),this.showloading=!0,this.$request.post("/coc-active/api/v1/sign_up/payment",{couponUserNews:o,payType:"3",signUpId:this.orderdetail.id,activityId:this.orderdetail.activityId,setMealId:this.orderdetail.activitySetMealId,isInsurance:t,subOpenId:(0,n.getstorage)("openid"),setMealAmount:this.orderdetail.flashSalePrice}).then((function(t){200==t.code?(e.showloading=!1,e.wxpay(t.data.payment.miniPayRequest)):e.$refs.uToast.show({message:t.message})}))},wxpay:function(t){var o=this;e.requestPayment({provider:"wxpay",timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,appid:t.appId,success:function(t){e.showToast({icon:"success",title:"支付成功",complete:function(){o.getcode()}})},fail:function(t){o.$request.get("/coc-active/api/v1/sign_up/paymentFailed/"+o.orderdetail.id).then((function(e){})),e.showToast({icon:"none",title:"支付失败"})}})},Onreport:function(){var t={shopVO:{headImg:this.orderdetail.shopAvatar,shopName:this.orderdetail.shopName,id:this.orderdetail.activityId},activity:{signUpEndTime:this.orderdetail.signUpEndTime,createdAt:this.orderdetail.createdAt,title:this.orderdetail.title,detail:""}};e.navigateTo({url:"/pages/my/myFeedback/index?type=1",success:function(e){e.eventChannel.emit("getinfo",{data:t})}})},getcode:function(){var e=this;this.isshowpage||this.$showLoading(),this.$request.post("/coc-my/activity/order/detail/v2",{orderNo:this.orderNo}).then((function(t){e.joinpeople=t.data.activitySignUpParticipants.length,e.orderdetail=t.data,e.allprice=t.data.paidMoney,e.couponList=t.data.couponVOS,e.choosecoupon=t.data.orderCouponListVO})).catch((function(e){})).finally((function(){e.isshowpage||(e.isshowpage=!0,e.$hideLoading())}))}}};t.default=i}).call(this,o("543d")["default"])}},[["b39f","common/runtime","common/vendor"]]]);