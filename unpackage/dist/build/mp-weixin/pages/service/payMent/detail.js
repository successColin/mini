(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/service/payMent/detail"],{1081:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return s}));var s={"u-Input":function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u--input/u--input")]).then(i.bind(null,"c00c"))},uDivider:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(i.bind(null,"944a"))},uIcon:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(i.bind(null,"0f14"))},uToast:function(){return i.e("uni_modules/uview-ui/components/u-toast/u-toast").then(i.bind(null,"1b13"))},uPopup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(i.bind(null,"8add"))},uCheckboxGroup:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-checkbox-group/u-checkbox-group")]).then(i.bind(null,"55a7"))},uCheckbox:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-checkbox/u-checkbox")]).then(i.bind(null,"f125"))},uLoadingPage:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-loading-page/u-loading-page")]).then(i.bind(null,"e325"))},uModal:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-modal/u-modal")]).then(i.bind(null,"ba5d"))},uKeyboard:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-keyboard/u-keyboard")]).then(i.bind(null,"c984"))},uCountDown:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uview-ui/components/u-count-down/u-count-down")]).then(i.bind(null,"cda7"))}},n=function(){var e=this,t=e.$createElement,i=(e._self._c,e.userList.length),s=0!=i?e.__map(e.userList,(function(t,i){var s=e.__get_orig(t),n=e.registrationList.indexOf(t),a=e.registrationList.indexOf(t);return{$orig:s,g1:n,g2:a}})):null,n=e.insuranceList.length,a=e.showcarkeyboard?null:e.totalprice.toFixed(2);e._isMounted||(e.e0=function(t){e.showclause=!1},e.e1=function(t){e.showdetail=!1},e.e2=function(t){e.showcarkeyboard=!1},e.e3=function(t){e.showcarkeyboard=!1}),e.$mp.data=Object.assign({},{$root:{g0:i,l0:s,g3:n,g4:a}})},a=[]},"364c":function(e,t,i){"use strict";var s=i("40f8"),n=i.n(s);n.a},"40f8":function(e,t,i){},5412:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i("04ff"),n={components:{},data:function(){return{timeData:{},isfinish:!1,showcarkeyboard:!1,plate:"",showloading:!1,isInsuranceVOS:[],totalprice:0,allpeople:"",checkboxValue1:[],showdetail:!1,showclause:!1,setMealNum:"",chooseadult:0,choosechildren:0,mobile:"",remark:"",adultNum:"",childrenNum:"",userList:[],registrationList:[],activityId:"",insuranceList:[],insurance:[],title:"",MealName:"",flashSalePrice:"",day:"",officialrelief:0,setMealId:"",attendId:"",registrationInformations:[],Events:"",choosepeople:"0",SelectedInsuranceNum:0,showmodal:!1,appletsShareType:0,isfirst:!1,activityPaymentPreferenceId:"",showagreement:!1,forwardUserId:""}},onLoad:function(t){var i=this,n=this;e.$on("refresh",(function(e){n.registrationList=[],n.chooseadult=0,n.choosechildren=0;var t=getCurrentPages(),i={};t.filter((function(e){e.$page.fullPath=="/pages/home/activityDetail/index?id="+n.activityId&&(i=e,i.$vm.Onaginsingup())}))})),(0,s.getstorage)(t.activityId)&&(this.appletsShareType=(0,s.getstorage)(t.activityId).split("_")[0]),t.activityPaymentPreferenceId&&(this.activityPaymentPreferenceId=t.activityPaymentPreferenceId),this.forwardUserId=t.forwardUserId,this.Events=t.Events,this.attendId=t.attendId,this.setMealId=t.setMealId,this.mobile=(0,s.getstorage)("mobile"),this.adultNum=t.personnum,this.childrenNum=t.childnum,this.setMealNum=t.setMealNum,this.activityId=t.activityId,this.title=t.title,this.MealName=t.MealName,this.flashSalePrice=t.flashSalePrice,this.totalprice=t.flashSalePrice*t.setMealNum,this.day=t.day,this.allpeople=Number(t.personnum)+Number(t.childnum),this.getActivityInsurance(t.activityId),this.showagreement=!0,setTimeout((function(){i.$refs.countDown.start()}),500)},onShow:function(){this.getuser()},computed:{},methods:{onChange:function(e){this.timeData=e},Onqianshu:function(){if(!this.isfinish)return!1;this.showagreement=!1,this.agree=!0},Onfinish:function(){this.isfinish=!0},Onbackspace:function(){if(0==this.plate.length)return!1;this.plate=this.plate.substr(0,this.plate.length-1)},changekeyboard:function(e){if(8==this.plate.length)return!1;this.plate=this.plate+e},OpenCarkeyboard:function(){this.showcarkeyboard=!0},OnOpenPdf:function(t){console.log(t),e.navigateTo({url:"/pages/activity/GoPdf/webview?url="+t.url})},paytrue:function(){var t=this;if(0===this.totalprice){if(this.registrationInformations=[],this.registrationList.filter((function(e){t.registrationInformations.push({participantsType:e.type,userName:e.name,idCard:e.idCard,participantsMobile:e.mobile})})),this.showloading=!0,this.isfirst)return!1;this.$request.post("/coc-active/api/v1/sign_up/signUp",{forwardUserId:this.forwardUserId,plate:this.plate,activityId:this.activityId,mobile:this.mobile,setMealId:this.setMealId,setMealNum:this.setMealNum,attendId:this.attendId,registrationInformations:this.registrationInformations,isInsuranceVOS:this.isInsuranceVOS,appletsShareType:this.appletsShareType,remark:this.remark}).then((function(i){200==i.code?(t.showmodal=!1,e.navigateTo({url:"/pages/my/myorder/couponcode?id="+i.data.orderNo}),t.showloading=!1):(t.showmodal=!1,t.isfirst=!0,t.showloading=!1,t.$refs.uToast.show({message:i.message}))}))}else{var i=0;if(this.insuranceList.filter((function(e){e.istrue&&i++})),0==this.checkboxValue1.length&&i>0)return this.insurance=[],this.insuranceList.filter((function(e,i){e.istrue&&t.insurance.push({name:e.insuranceName,url:e.sericeClause})})),this.showmodal=!1,this.showclause=!0,!1;if(this.registrationInformations=[],this.registrationList.filter((function(e){t.registrationInformations.push({participantsType:e.type,userName:e.name,idCard:e.idCard,participantsMobile:e.mobile})})),this.isInsuranceVOS=[],this.insuranceList.filter((function(e){e.istrue&&t.isInsuranceVOS.push(e)})),this.isfirst)return!1;this.isfirst=!0,this.$request.post("/coc-active/api/v1/sign_up/signUp",{forwardUserId:this.forwardUserId,plate:this.plate,activityId:this.activityId,mobile:this.mobile,setMealId:this.setMealId,setMealNum:this.setMealNum,attendId:this.attendId,registrationInformations:this.registrationInformations,isInsuranceVOS:this.isInsuranceVOS,appletsShareType:this.appletsShareType,remark:this.remark}).then((function(i){if(200==i.code){var s=[];t.showmodal=!1,t.insuranceList.filter((function(e){e.istrue&&s.push(e)})),e.navigateTo({url:"/pages/service/payMent/index?MealName="+t.MealName+"&setMealNum="+t.setMealNum+"&flashSalePrice="+t.flashSalePrice+"&Events="+t.Events+"&allpeople="+t.allpeople+"&day="+t.day+"&officialrelief="+t.officialrelief+"&totalprice="+t.totalprice+"&activityId="+t.activityId+"&setMealId="+t.setMealId+"&orderNo="+i.data.orderNo+"&choosepeople="+t.choosepeople+"&signUpId="+i.data.signUpId+"&isScoreDeduction="+i.data.isScoreDeduction+"&scoreDeduction="+i.data.scoreDeduction+"&surplusScore="+i.data.surplusScore,success:function(e){e.eventChannel.emit("payinfo",{data:{list:s,couponVOS:i.data.couponVOS}})}})}else t.showmodal=!1,t.isfirst=!0,t.$refs.uToast.show({message:i.message})}))}},Ontrue:function(){var t=this;console.log("转跳支付",this.forwardUserId),this.showdetail=!1,this.$request.post("/coc-active/api/v1/payment/preference/userIsCanBuyProduct",{activityPaymentPreferenceId:this.activityPaymentPreferenceId,goodsId:this.activityId,plate:this.plate,type:1}).then((function(i){if(200!=i.code)return e.$u.toast(i.message),!1;if(1==i.data.isCanBuy)t.paytrue();else if(0==i.data.isCanBuy){var s="";return 4==t.activityPaymentPreferenceId?s="人保":5==t.activityPaymentPreferenceId?s="农行":6==t.activityPaymentPreferenceId?s="工行":7==t.activityPaymentPreferenceId?s="邮储":8==t.activityPaymentPreferenceId?s="民生":10==t.activityPaymentPreferenceId&&(s="官方"),e.$u.toast("当月每人"+s+"活动仅限参与"+i.data.userOrderLimitCount+"次，您已参加过"),!1}}))},OnPay:function(){var t=this;console.log("转跳支付",this.forwardUserId),this.showdetail=!1;var i=0,s=0;return this.registrationList.filter((function(e){1==e.type?i++:s++})),0==i&&0==s?(this.$refs.uToast.show({message:"请选择报名人"}),!1):i!=this.adultNum||s!=this.childrenNum?(this.showmodal=!0,!1):void this.$request.post("/coc-active/api/v1/payment/preference/userIsCanBuyProduct",{activityPaymentPreferenceId:this.activityPaymentPreferenceId,goodsId:this.activityId,plate:this.plate,type:1}).then((function(i){if(200!=i.code)return e.$u.toast(i.message),!1;if(1==i.data.isCanBuy)t.paynext();else if(0==i.data.isCanBuy){var s="";return 4==t.activityPaymentPreferenceId?s="人保":5==t.activityPaymentPreferenceId?s="农行":6==t.activityPaymentPreferenceId?s="工行":7==t.activityPaymentPreferenceId?s="邮储":8==t.activityPaymentPreferenceId?s="民生":10==t.activityPaymentPreferenceId&&(s="官方"),e.$u.toast("当月每人"+s+"活动仅限参与"+i.data.userOrderLimitCount+"次，您已参加过"),!1}}))},paynext:function(){var t=this;if(0===this.totalprice){if(this.registrationInformations=[],this.registrationList.filter((function(e){t.registrationInformations.push({participantsType:e.type,userName:e.name,idCard:e.idCard,participantsMobile:e.mobile})})),this.isInsuranceVOS=[],this.insuranceList.filter((function(e){e.istrue&&t.isInsuranceVOS.push(e)})),this.showloading=!0,this.isfirst)return!1;this.isfirst=!0,this.$request.post("/coc-active/api/v1/sign_up/signUp",{forwardUserId:this.forwardUserId,plate:this.plate,activityId:this.activityId,mobile:this.mobile,setMealId:this.setMealId,setMealNum:this.setMealNum,attendId:this.attendId,registrationInformations:this.registrationInformations,isInsuranceVOS:this.isInsuranceVOS,appletsShareType:this.appletsShareType,remark:this.remark}).then((function(i){200==i.code?(t.showmodal=!1,e.navigateTo({url:"/pages/my/myorder/couponcode?id="+i.data.orderNo}),t.showloading=!1):(t.showmodal=!1,t.isfirst=!0,t.showloading=!1,t.$refs.uToast.show({message:i.message}))}))}else{var i=0;if(this.insuranceList.filter((function(e){e.istrue&&i++})),0==this.checkboxValue1.length&&i>0)return this.insurance=[],this.insuranceList.filter((function(e,i){e.istrue&&t.insurance.push({name:e.insuranceName,url:e.sericeClause})})),this.showclause=!0,!1;if(this.registrationInformations=[],this.registrationList.filter((function(e){t.registrationInformations.push({participantsType:e.type,userName:e.name,idCard:e.idCard,participantsMobile:e.mobile})})),this.isInsuranceVOS=[],this.insuranceList.filter((function(e){e.istrue&&t.isInsuranceVOS.push(e)})),this.isfirst)return!1;this.isfirst=!0,this.$request.post("/coc-active/api/v1/sign_up/signUp",{forwardUserId:this.forwardUserId,plate:this.plate,activityId:this.activityId,mobile:this.mobile,setMealId:this.setMealId,setMealNum:this.setMealNum,attendId:this.attendId,registrationInformations:this.registrationInformations,isInsuranceVOS:this.isInsuranceVOS,appletsShareType:this.appletsShareType,remark:this.remark}).then((function(i){if(200==i.code){var s=[];t.showmodal=!1,t.insuranceList.filter((function(e){e.istrue&&s.push(e)})),e.navigateTo({url:"/pages/service/payMent/index?MealName="+t.MealName+"&setMealNum="+t.setMealNum+"&flashSalePrice="+t.flashSalePrice+"&Events="+t.Events+"&allpeople="+t.allpeople+"&day="+t.day+"&officialrelief="+t.officialrelief+"&totalprice="+t.totalprice+"&activityId="+t.activityId+"&setMealId="+t.setMealId+"&orderNo="+i.data.orderNo+"&choosepeople="+t.choosepeople+"&signUpId="+i.data.signUpId+"&isScoreDeduction="+i.data.isScoreDeduction+"&scoreDeduction="+i.data.scoreDeduction+"&surplusScore="+i.data.surplusScore,success:function(e){e.eventChannel.emit("payinfo",{data:{list:s,couponVOS:i.data.couponVOS}})}})}else t.showmodal=!1,t.isfirst=!1,t.$refs.uToast.show({message:i.message})}))}},Onknow:function(){if(0==this.checkboxValue1.length)return this.$refs.uToast.show({message:"请确认阅读条款"}),!1;this.showclause=!1},getActivityInsurance:function(e){var t=this,i=0;this.SelectedInsuranceNum=0,this.$request.get("/coc-active/api/v1/activity/getActivityInsurance/"+e).then((function(e){e.data.filter((function(e){1==e.isUndertaker?(t.SelectedInsuranceNum++,e.istrue=!0,i=0,i=e.insurancePrice*t.day*t.choosepeople,t.officialrelief=t.officialrelief+i):e.istrue=!1})),t.insuranceList=e.data}))},Onclosedetail:function(){this.showdetail=!1},OnOpenDetail:function(){this.showdetail=!this.showdetail},Onopenpop:function(e){var t=this;this.insurance=[],this.insuranceList.filter((function(e,i){e.istrue&&t.insurance.push({name:e.insuranceName,sericeClause:e.sericeClause})})),this.showclause=!0},Onedit:function(t){e.navigateTo({url:"/pages/my/contacts/detail?id="+t})},OnChooseUsre:function(t,i){var s=this,n=!0;this.registrationList.length>0&&this.registrationList.filter((function(e,i){e.id==t.id&&(1==e.type&&(s.insuranceList.filter((function(e){e.istrue&&2==e.isUndertaker&&(s.totalprice=s.totalprice-e.insurancePrice*Number(s.day))})),s.chooseadult>0&&s.chooseadult--),2==e.type&&(s.insuranceList.filter((function(e){e.istrue&&2==e.isUndertaker&&(s.totalprice=s.totalprice-e.insurancePrice*Number(s.day))})),s.choosechildren>0&&s.choosechildren--),s.registrationList.splice(i,1),s.choosepeople=s.registrationList.length,n=!1)})),e.$u.sleep(30).then((function(){if(n){if(1==t.type){if(!(s.adultNum>s.chooseadult))return s.$refs.uToast.show({message:"最多选择"+s.adultNum+"个成人"}),!1;s.insuranceList.filter((function(e){e.istrue&&2==e.isUndertaker&&(s.totalprice=s.totalprice+e.insurancePrice*Number(s.day))})),s.chooseadult+=1}if(2==t.type){if(!(s.childrenNum>s.choosechildren))return s.$refs.uToast.show({message:"最多选择"+s.childrenNum+"个儿童"}),!1;s.insuranceList.filter((function(e){e.istrue&&2==e.isUndertaker&&(s.totalprice=s.totalprice+e.insurancePrice*Number(s.day))})),s.choosechildren+=1}s.registrationList.push(t),s.choosepeople=s.registrationList.length}s.officialrelief=0;var e=0;s.insuranceList.filter((function(t){1==t.isUndertaker&&(e=0,e=t.insurancePrice*s.day*s.choosepeople,s.officialrelief=s.officialrelief+e)}))}))},OnChoose:function(e,t){var i=this;if(1==e.isUndertaker)return!1;if(e.istrue){var s;return s=e.insurancePrice*Number(this.day)*this.choosepeople,this.totalprice=this.totalprice-s,this.insuranceList[t].istrue=!this.insuranceList[t].istrue,!1}this.insuranceList[t].istrue=!this.insuranceList[t].istrue,this.insuranceList.filter((function(e){2==e.isUndertaker&&e.istrue&&(i.totalprice=e.insurancePrice*i.day*i.choosepeople+i.totalprice)})),this.SelectedInsuranceNum=0,this.insuranceList.filter((function(e){e.istrue&&i.SelectedInsuranceNum++}))},OnAddUser:function(){e.navigateTo({url:"/pages/my/contacts/index"}),this.showmodal=!1},getuser:function(){var e=this;this.$request.post("/coc-my/api/v1/userContacts/list",{keyword:"",current:1,size:99}).then((function(t){e.userList.length!=t.data.records.length&&(e.chooseadult=0,e.choosechildren=0,e.userList=t.data.records)}))}}};t.default=n}).call(this,i("543d")["default"])},c507:function(e,t,i){"use strict";(function(e,t){var s=i("4ea4");i("76b1");s(i("66fd"));var n=s(i("fec8"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},f560:function(e,t,i){"use strict";i.r(t);var s=i("5412"),n=i.n(s);for(var a in s)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(a);t["default"]=n.a},fec8:function(e,t,i){"use strict";i.r(t);var s=i("1081"),n=i("f560");for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);i("364c");var r=i("f0c5"),o=Object(r["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);t["default"]=o.exports}},[["c507","common/runtime","common/vendor"]]]);