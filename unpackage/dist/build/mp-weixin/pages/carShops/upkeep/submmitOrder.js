(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/carShops/upkeep/submmitOrder"],{"139f":function(t,a,e){"use strict";e.d(a,"b",(function(){return n})),e.d(a,"c",(function(){return i})),e.d(a,"a",(function(){return o}));var o={uIcon:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(e.bind(null,"0f14"))},uToast:function(){return e.e("uni_modules/uview-ui/components/u-toast/u-toast").then(e.bind(null,"1b13"))}},n=function(){var t=this.$createElement,a=(this._self._c,this.orderData.couponUserNews&&0==this.orderData.couponUserNews.length);this.$mp.data=Object.assign({},{$root:{g0:a}})},i=[]},1432:function(t,a,e){},"1ada":function(t,a,e){"use strict";(function(t,o){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=e("04ff"),i={components:{},data:function(){return{isform:0,forwardUserId:"",showpay:!0,orderData:{},userId:"",totalprice:0,choosecoupon:{},id:"",customerManagerId:"",payData:{uMobile:"",userId:"",couponId:"",maintainMealId:"",couponMoney:0,maintainNum:1,payType:"2"},minMoney:!1,formType:1}},onLoad:function(a){var e=this;(0,n.getstorage)("token")||(0,n.tologin)(),2==a.formType&&(this.formType=2),a.customerManagerId&&(this.customerManagerId=a.customerManagerId),a.isform&&(this.isform=1),this.payData.maintainMealId=a.id,this.forwardUserId=a.forwardUserId,this.payData.uMobile=(0,n.getstorage)("mobile"),this.payData.userId=(0,n.getstorage)("userId"),this.getOrder(a.id),t.$on("choosecoupon",(function(t){e.payData.couponId=t.data,t.data?(e.totalprice=e.payData.maintainNum*e.orderData.price,e.orderData.couponUserNews.filter((function(a){a.couponUserNewId==t.data&&(e.choosecoupon=a,e.payData.couponMoney=a.discountMoney,e.totalprice=(e.totalprice-e.payData.couponMoney).toFixed(2))})),e.totalprice<=0?(e.minMoney=!0,e.totalprice=.01):e.minMoney=!1):(e.choosecoupon={},e.totalprice=e.payData.maintainNum*e.orderData.price,e.payData.couponMoney=0)}))},methods:{changeTel:function(t){this.payData.uMobile=t.detail.value.trim()},addNum:function(){this.payData.maintainNum++,this.choosecoupon.discountMoney?this.totalprice=this.payData.maintainNum*this.orderData.price-this.choosecoupon.discountMoney:this.totalprice=this.payData.maintainNum*this.orderData.price,this.totalprice<=0?(this.minMoney=!0,this.totalprice=.01):this.minMoney=!1},minNum:function(){this.payData.maintainNum>1?this.payData.maintainNum--:this.payData.maintainNum=1,this.choosecoupon.discountMoney?this.totalprice=this.payData.maintainNum*this.orderData.price-this.choosecoupon.discountMoney:this.totalprice=this.payData.maintainNum*this.orderData.price,this.totalprice<=0?(this.minMoney=!0,this.totalprice=.01):this.minMoney=!1},checkQuan:function(){var a=this;t.navigateTo({url:"/pages/carShops/upkeep/checkCouponlist",success:function(t){t.eventChannel.emit("couponList",{data:{couponList:a.orderData.couponUserNews,couponId:a.payData.couponId}})}})},getOrder:function(t){var a=this;this.$newrequest.post("/coc-active/api/v2/maintain_meal/buyNow",{maintainMealId:t}).then((function(t){a.orderData=t.data,a.totalprice=t.data.price}))},OnPay:function(){var a=this;if(0==this.showpay)return!1;this.showpay=!1,a.payData.subOpenId=t.getStorageSync("openid"),a.customerManagerId&&(a.payData.customerManagerId=a.customerManagerId),this.payData.forwardUserId=this.forwardUserId,this.$request.post("/coc-active/api/v2/maintain_meal/payment",a.payData).then((function(t){200==t.code?(a.showloading=!1,a.wxpay(t.data.payment.miniPayRequest,t.data.orderId)):a.$refs.uToast.show({message:t.message})}))},wxpay:function(a,e){var n=this;t.requestPayment({provider:"wxpay",timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,appid:a.appId,success:function(a){t.showToast({icon:"success",title:"支付成功",duration:"2000"}),2===n.formType?o.navigateBack({delta:getCurrentPages().length}):n.isform?t.navigateBack({delta:2}):t.reLaunch({url:"/pages/carShops/upkeep/orderStatus?id="+e})},fail:function(a){t.showToast({icon:"none",title:"支付失败"}),t.reLaunch({url:"/pages/my/myUpkeepOrder/detail?id="+e})}})}}};a.default=i}).call(this,e("543d")["default"],e("bc2e")["default"])},"4c3b":function(t,a,e){"use strict";(function(t,a){var o=e("4ea4");e("76b1");o(e("66fd"));var n=o(e("90e3"));t.__webpack_require_UNI_MP_PLUGIN__=e,a(n.default)}).call(this,e("bc2e")["default"],e("543d")["createPage"])},"8f59":function(t,a,e){"use strict";var o=e("1432"),n=e.n(o);n.a},"90e3":function(t,a,e){"use strict";e.r(a);var o=e("139f"),n=e("b749");for(var i in n)["default"].indexOf(i)<0&&function(t){e.d(a,t,(function(){return n[t]}))}(i);e("8f59");var r=e("f0c5"),s=Object(r["a"])(n["default"],o["b"],o["c"],!1,null,"7e0fdc76",null,!1,o["a"],void 0);a["default"]=s.exports},b749:function(t,a,e){"use strict";e.r(a);var o=e("1ada"),n=e.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){e.d(a,t,(function(){return o[t]}))}(i);a["default"]=n.a}},[["4c3b","common/runtime","common/vendor"]]]);